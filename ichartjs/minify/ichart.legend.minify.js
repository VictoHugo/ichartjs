iChart.Legend=iChart.extend(iChart.Component,{configure:function(){iChart.Legend.superclass.configure.apply(this,arguments);this.type="legend";this.set({data:void 0,width:"auto",column:1,row:"max",maxwidth:0,line_height:16,sign:"square",sign_size:12,sign_space:5,legendspace:5,text_with_sign_color:!1,align:"right",valign:"middle"});this.registerEvent("drawCell","analysing","drawRaw")},drawCell:function(b,c,f,d){var a=this.get("sign_size"),e=this.get("sign");"round"==e?this.T.round(b+a/2,c+a/2,a/2,
d):"round-bar"==e?(this.T.rectangle(b,c+5*a/12,a,a/6,d),this.T.round(b+a/2,c+a/2,a/4,d)):"square-bar"==e?(this.T.rectangle(b,c+5*a/12,a,a/6,d),this.T.rectangle(b+a/4,c+a/4,a/2,a/2,d)):this.T.rectangle(b,c,a,a,d);e=this.get("color");this.get("text_with_sign_color")&&(e=d);this.T.fillText(f,b+this.get("signwidth"),c+a/2,this.get("textwidth"),e);this.fireEvent(this,"drawCell",[b,c,f,d])},drawRow:function(b,c,f){for(var d,a=0;a<this.get("column");a++)d=this.data[b],b<this.data.length&&(this.fireEvent(this,
"drawCell",[d]),this.drawCell(c,f,d.text,d.color),d.x=c,d.y=f),c+=this.columnwidth[a]+this.get("signwidth")+this.get("legendspace"),b++},isEventValid:function(b){if(b.offsetX>this.x&&b.offsetX<this.x+this.width&&b.offsetY>this.y&&b.offsetY<this.y+this.height)for(var c=0;c<this.data.length;c++)if(b.offsetX>this.data[c].x&&b.offsetX<this.data[c].x+this.data[c].width+this.get("signwidth")&&b.offsetY>this.data[c].y&&b.offsetY<this.data[c].y+this.get("line_height"))return{valid:!0,value:c,target:this.data[c]};
return{valid:!1}},doDraw:function(){this.get("border.enable")&&this.T.drawBorder(this.x,this.y,this.width,this.height,this.get("border.width"),this.get("border.color"),this.get("border.radius"),this.get("fill_color"),!1,this.get("shadow"),this.get("shadow_color"),this.get("shadow_blur"),this.get("shadow_offsetx"),this.get("shadow_offsety"));this.T.textStyle("left","middle",iChart.getFont(this.get("fontweight"),this.get("fontsize"),this.get("font")));for(var b=this.x+this.get("padding_left"),c=this.y+
this.get("padding_top"),f=this.get("column"),d=this.get("row"),a=0;a<d;a++)this.fireEvent(this,"drawRaw",[a*f]),this.drawRow(a*f,b,c),c+=this.get("line_height")},doConfig:function(){iChart.Legend.superclass.doConfig.call(this);iChart.Assert.isNotEmpty(this.get("data"),this.type+"[data]");var b=0,c=w=this.get("width"),f=0,d="auto"==w,a=this.get("sign_size"),e=iChart.isNumber(this.get("column")),g=iChart.isNumber(this.get("row")),h=this.data.length;this.push("signwidth",a+this.get("sign_space"));this.get("line_height")<
a&&this.push("line_height",a+a/5);!e&&!g&&(e=1);e&&!g&&this.push("row",Math.ceil(h/this.get("column")));!e&&g&&this.push("column",Math.ceil(h/this.get("row")));e=this.get("column");g=this.get("row");this.columnwidth=Array(e);d&&(this.T.textFont(this.get("fontStyle")),c=0);for(a=0;a<h;a++)b=this.data[a],iChart.merge(b,this.fireEvent(this,"analysing",[b,a])),b.text=b.text||b.name,b.width=this.T.measureText(b.text);for(a=0;a<e;a++){f=0;for(b=a;b<h;)f=Math.max(f,this.data[b].width),b+=e;this.columnwidth[a]=
f;c+=f}d&&(w=this.push("width",c+this.get("hpadding")+this.get("signwidth")*e+(e-1)*this.get("legendspace")));w>this.get("maxwidth")&&(w=this.push("width",this.get("maxwidth")));this.push("textwidth",w-this.get("hpadding")-this.get("signwidth"));this.width=w;this.height=c=this.push("height",g*this.get("line_height")+this.get("vpadding"));"center"==this.get("align")&&"middle"==this.get("valign")&&this.push("valign","top");"left"==this.getC("align")&&"middle"==this.get("valign")&&this.push("align",
"right");this.y="top"==this.get("valign")?this.getC("t_originy"):"bottom"==this.get("valign")?this.getC("b_originy")-c:this.getC("centery")-c/2;this.x="left"==this.get("align")?this.getC("l_originx"):"center"==this.get("align")?this.getC("centerx")-this.get("textwidth")/2:this.getC("r_originx")-w;this.x=this.push("originx",this.x+this.get("offsetx"));this.y=this.push("originy",this.y+this.get("offsety"))}});
