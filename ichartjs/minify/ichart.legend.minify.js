iChart.Legend=iChart.extend(iChart.Component,{configure:function(){iChart.Legend.superclass.configure.apply(this,arguments);this.type="legend";this.set({data:void 0,width:"auto",column:1,row:"max",maxwidth:0,line_height:16,sign:"square",sign_size:12,sign_space:5,legend_space:5,text_with_sign_color:!1,align:"right",valign:"middle"});this.atomic=!0;this.registerEvent("parse","drawRaw","drawCell")},drawCell:function(a,c,e,d){var b=this.get("sign_size"),h=this.get("sign");"round"==h?this.T.round(a+b/2,c+b/2,b/2,d):"round-bar"==h?(this.T.box(a,c+5*b/12,b,b/6,0,d),this.T.round(a+b/2,c+b/2,b/4,d)):"square-bar"==h?(this.T.box(a,c+5*b/12,b,b/6,0,d),this.T.box(a+b/4,c+b/4,b/2,b/2,0,d)):this.T.box(a,c,b,b,0,d);h=this.get("color");this.get("text_with_sign_color")&&(h=d);this.T.fillText(e,a+this.get("signwidth"),c+b/2,this.get("textwidth"),h);this.fireEvent(this,"drawCell",[this])},drawRow:function(a,c,e){for(var d,b=0;b<this.get("column");b++)d=this.data[a],a<this.data.length&&(this.fireEvent(this,"drawCell",[d]),this.drawCell(c,e,d.text,d.color),d.x=c,d.y=e),c+=this.columnwidth[b]+this.get("signwidth")+this.get("legend_space"),a++},isEventValid:function(a){var c={valid:!1},e=this._();a.x>this.x&&a.x<e.x+e.width&&a.y>e.y&&a.y<e.y+e.height&&e.data.each(function(d,b){a.x>d.x&&a.x<d.x+d.width+e.get("signwidth")&&a.y>d.y&&a.y<d.y+e.get("line_height")&&(c={valid:!0,index:b,target:d})},e);return c},doDraw:function(){this.T.box(this.x,this.y,this.width,this.height,this.get("border"),this.get("f_color"),!1,this.get("shadow"));this.T.textStyle("left","middle",iChart.getFont(this.get("fontweight"),this.get("fontsize"),this.get("font")));for(var a=this.x+this.get("padding_left"),c=this.y+this.get("padding_top"),e=this.get("column"),d=this.get("row"),b=0;b<d;b++)this.drawRow(b*e,a,c),c+=this.get("line_height"),this.fireEvent(this,"drawRaw",[this,b*e])},doConfig:function(){iChart.Legend.superclass.doConfig.call(this);var a=this._(),c=a.get("sign_size"),e=a.container;a.T.textFont(a.get("fontStyle"));a.push("signwidth",c+a.get("sign_space"));a.get("line_height")<c&&a.push("line_height",c+c/5);"center"==a.get("align")&&"middle"==a.get("valign")&&a.push("valign","top");"left"==e.get("align")&&"middle"==a.get("valign")&&a.push("align","right");var c=0,d=w=a.get("width"),b=0,h="auto"==w,f=iChart.isNumber(a.get("column")),g=iChart.isNumber(a.get("row")),i=a.data.length;!f&&!g&&(f=1);f&&!g&&a.push("row",Math.ceil(i/a.get("column")));!f&&g&&a.push("column",Math.ceil(i/a.get("row")));f=a.get("column");g=a.get("row");i>g*f&&(g+=Math.ceil((i-g*f)/f),a.push("row",g));a.columnwidth=Array(f);h&&(d=0);a.data.each(function(b,c){iChart.merge(b,a.fireEvent(a,"parse",[a,b.name,c]));b.text=b.text||b.name;b.width=a.T.measureText(b.text)},a);for(var j=0;j<f;j++){b=0;for(c=j;c<i;)b=Math.max(b,a.data[c].width),c+=f;a.columnwidth[j]=b;d+=b}h&&(w=a.push("width",d+a.get("hpadding")+a.get("signwidth")*f+(f-1)*a.get("legend_space")));w>a.get("maxwidth")&&(w=a.push("width",a.get("maxwidth")));a.push("textwidth",w-a.get("hpadding")-a.get("signwidth"));a.width=w;a.height=c=a.push("height",g*a.get("line_height")+a.get("vpadding"));a.y="top"==a.get("valign")?e.get("t_originy"):"bottom"==a.get("valign")?e.get("b_originy")-c:e.get("centery")-c/2;a.x="left"==a.get("align")?e.get("l_originx"):"center"==a.get("align")?e.get("centerx")-a.get("textwidth")/2:e.get("r_originx")-w;a.x=a.push("originx",a.x+a.get("offsetx"));a.y=a.push("originy",a.y+a.get("offsety"))}});