iChart.Scale=iChart.extend(iChart.Component,{configure:function(){iChart.Scale.superclass.configure.apply(this,arguments);this.type="scale";this.set({which:"h",distance:void 0,start_scale:0,end_scale:void 0,min_scale:void 0,max_scale:void 0,scale_space:void 0,scale_share:5,scale_enable:!0,scale_size:1,scale_width:4,scale_color:"#333333",scaleAlign:"center",labels:[],scale2grid:!0,text_height:16,text_space:4,textAlign:"left",decimalsnum:0,join_style:"none",join_size:2});this.registerEvent("parseText");this.items=[];this.number=0},isEventValid:function(){return{valid:!1}},doDraw:function(){var a=y=x0=y0=tx=ty=0,d=this.get("scale_width"),f=d/2,e=this.get("scaleAlign"),b=this.get("textAlign"),c=this.get("text_space");this.isH?("top"==e?y=-d:"center"==e?(y=-f,y0=f):y0=d,this.T.textAlign("center"),"top"==b)?(ty=-c,this.T.textBaseline("bottom")):(ty=c,this.T.textBaseline("top")):("left"==e?a=-d:"center"==e?(a=-f,x0=f):x0=d,this.T.textBaseline("middle"),"right"==b)?(this.T.textAlign("left"),tx=c):(this.T.textAlign("right"),tx=-c);this.T.textFont(this.get("fontStyle"));for(d=0;d<this.items.length;d++)this.get("scale_enable")&&this.T.line(this.items[d].x+a,this.items[d].y+y,this.items[d].x+x0,this.items[d].y+y0,this.get("scale_size"),this.get("scale_color"),!1),this.T.fillText(this.items[d].text,this.items[d].textX+tx,this.items[d].textY+ty,!1,this.get("color"),"lr",this.get("text_height"))},doConfig:function(){iChart.Scale.superclass.doConfig.call(this);iChart.Assert.isNumber(this.get("distance"),"distance");var a=this.get("labels").length,d=this.get("min_scale"),f=this.get("max_scale"),e=this.get("scale_space"),b=this.get("end_scale"),c=this.get("start_scale");if(0<a)this.number=a-1;else{iChart.Assert.isTrue(iChart.isNumber(f)||iChart.isNumber(b),"max_scale&end_scale");if(!b||b<f)b=this.push("end_scale",iChart.ceil(f));c>d&&this.push("start_scale",iChart.floor(d));e&&e<b-c&&this.push("scale_share",(b-c)/e);if(!e||e>b-c)e=this.push("scale",(b-c)/this.get("scale_share"));this.number=this.get("scale_share");if(1>e&&0==this.get("decimalsnum"))for(d=e;1>d;)d*=10,this.push("decimalsnum",this.get("decimalsnum")+1)}this.push("distanceOne",this.get("valid_distance")/this.number);var f=0,j;this.T.textFont(this.get("fontStyle"));this.push("which",this.get("which").toLowerCase());this.isH="h"==this.get("which");for(var g=0;g<=this.number;g++)d=a?this.get("labels")[g]:(e*g+c).toFixed(this.get("decimalsnum")),b=this.isH?this.get("valid_x")+g*this.get("distanceOne"):this.x,j=this.isH?this.y:this.get("valid_y")+this.get("distance")-g*this.get("distanceOne"),this.items.push(iChart.merge({text:d,x:b,y:j,textX:b,textY:j},this.fireEvent(this,"parseText",[d,b,j,g]))),f=Math.max(f,this.T.measureText(d));this.left=this.right=this.top=this.bottom=0;ts=this.get("text_space");ta=this.get("textAlign");sa=this.get("scaleAlign");w=this.get("scale_width");w2=w/2;this.isH?(this.top="top"==sa?w:"center"==sa?w2:0,this.bottom=w-this.top,"top"==ta?this.top+=this.get("text_height")+ts:this.bottom+=this.get("text_height")+ts):(this.left="left"==sa?w:"center"==sa?w2:0,this.right=w-this.left,"left"==ta?this.left+=f+ts:this.right+=f+ts)}});iChart.Coordinate2D=iChart.extend(iChart.Component,{configure:function(){iChart.Coordinate2D.superclass.configure.apply(this,arguments);this.type="coordinate2d";this.set({sign_size:12,sign_space:5,scale:[],valid_width:void 0,valid_height:void 0,grid_line_width:1,grid_color:"#dbe1e1",gridlinesVisible:!0,scale2grid:!0,grids:void 0,ignoreOverlap:!0,ignoreEdge:!1,xlabel:"",ylabel:"",alternate_color:!0,crosshair:{enable:!1},width:void 0,height:void 0,axis:{enable:!0,color:"#666666",width:1}});this.registerEvent();this.scale=[];this.gridlines=[]},getScale:function(a){for(var d=0;d<this.scale.length;d++){var f=this.scale[d];if(f.get("position")==a)return{start:f.get("start_scale"),end:f.get("end_scale"),distance:f.get("end_scale")-f.get("start_scale")}}return{start:0,end:0,distance:0}},isEventValid:function(a){return{valid:a.offsetX>this.x&&a.offsetX<this.x+this.get("width")&&a.offsetY<this.y+this.get("height")&&a.offsetY>this.y}},doDraw:function(){this.T.rectangle(this.x,this.y,this.get("width"),this.get("height"),this.get("fill_color"),this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("shadow"),this.get("shadow_color"),this.get("shadow_blur"),this.get("shadow_offsetx"),this.get("shadow_offsety"));if(this.get("alternate_color")){var a,d=!1,f=[0,0,0,0],e=iChart.dark(this.get("background_color"),0.04);this.get("axis.enable")&&(f=this.get("axis.width"))}for(var b=this.gridlines,c=0;c<b.length;c++)b[c].x1=Math.round(b[c].x1),b[c].y1=Math.round(b[c].y1),b[c].x2=Math.round(b[c].x2),b[c].y2=Math.round(b[c].y2),this.get("alternate_color")&&b[c].y1==b[c].y2&&(d&&this.T.rectangle(b[c].x1+f[3],b[c].y1+this.get("grid_line_width"),b[c].x2-b[c].x1-f[3]-f[1],a-b[c].y1-this.get("grid_line_width"),e),a=b[c].y1,d=!d),this.T.line(b[c].x1,b[c].y1,b[c].x2,b[c].y2,this.get("grid_line_width"),this.get("grid_color"));for(c=0;c<this.scale.length;c++)this.scale[c].draw()},doConfig:function(){iChart.Coordinate2D.superclass.doConfig.call(this);iChart.Assert.isNumber(this.get("width"),"width");iChart.Assert.isNumber(this.get("height"),"height");this.atomic=!1;(!this.get("valid_width")||this.get("valid_width")>this.get("width"))&&this.push("valid_width",this.get("width"));(!this.get("valid_height")||this.get("valid_height")>this.get("height"))&&this.push("valid_height",this.get("height"));this.get("gradient")&&iChart.isString(this.get("background_color"))&&this.push("fill_color",this.T.avgLinearGradient(this.x,this.y,this.x,this.y+this.get("height"),[this.get("dark_color"),this.get("light_color")]));if(this.get("axis.enable")){var a=this.get("axis.width");iChart.isArray(a)||this.push("axis.width",[a,a,a,a])}this.get("crosshair.enable")&&(this.push("crosshair.wrap",this.container.shell),this.push("crosshair.height",this.get("height")),this.push("crosshair.width",this.get("width")),this.push("crosshair.top",this.y),this.push("crosshair.left",this.x),this.crosshair=new iChart.CrossHair(this.get("crosshair"),this));var d,f=!(!this.get("gridlinesVisible")||!this.get("grids")),a=f&&!!this.get("grids.horizontal"),e=f&&!!this.get("grids.vertical"),b=this.get("height"),c=this.get("width"),j=this.get("valid_width"),g=this.get("valid_height"),h=this.get("gridlinesVisible")&&this.get("scale2grid")&&!(a&&e),o=(c-j)/2;sh=(b-g)/2;axis=this.get("axis.width");iChart.isArray(this.get("scale"))||(iChart.isObject(this.get("scale"))?this.push("scale",[this.get("scale")]):this.push("scale",[]));this.get("scale").each(function(a){d=(d=a.position)||"left";d=d.toLowerCase();a.originx=this.x;a.originy=this.y;a.valid_x=this.x+o;a.valid_y=this.y+sh;a.position=d;if(d=="top"){a.which="h";a.distance=c;a.valid_distance=j}else if(d=="right"){a.which="v";a.distance=b;a.valid_distance=g;a.originx=a.originx+c;a.valid_x=a.valid_x+j}else if(d=="bottom"){a.which="h";a.distance=c;a.valid_distance=j;a.originy=a.originy+b;a.valid_y=a.valid_y+g}else{a.which="v";a.distance=b;a.valid_distance=g}this.scale.push(new iChart.Scale(a,this.container))},this);if(f=this.push("ignoreOverlap",this.get("ignoreOverlap")&&this.get("axis.enable")||this.get("ignoreEdge")))var n=this.get("ignoreEdge")?function(a,c,d){return a=="v"?d==this.y||d==this.y+b:c==this.x||c==this.x+a}:function(a,d,e){return a=="v"?e==this.y&&axis[0]>0||e==this.y+b&&axis[2]>0:d==this.x&&axis[3]>0||d==this.x+c&&axis[1]>0};if(h)for(var i,l,m,h=0;h<this.scale.length;h++)if(i=this.scale[h],!iChart.isFalse(i.get("scale2grid"))&&!(a&&"v"==i.get("which")||e&&"h"==i.get("which"))){l=m=0;"top"==i.get("position")?m=b:"right"==i.get("position")?l=-c:"bottom"==i.get("position")?m=-b:l=c;for(var k=0;k<i.items.length;k++)(!f||!n.call(this,i.get("which"),i.items[k].x,i.items[k].y))&&this.gridlines.push({x1:i.items[k].x,y1:i.items[k].y,x2:i.items[k].x+l,y2:i.items[k].y+m})}if(e){h=this.get("grids.vertical");iChart.Assert.gtZero(h.value,"value");e=c/h.value;i=h.value;"given_value"==h.way&&(i=e,e=h.value,e=e>c?c:e);for(h=0;h<=i;h++)(!f||!n.call(this,"h",this.x+h*e,this.y))&&this.gridlines.push({x1:this.x+h*e,y1:this.y,x2:this.x+h*e,y2:this.y+b})}if(a){a=this.get("grids.horizontal");iChart.Assert.gtZero(a.value,"value");e=b/a.value;i=a.value;"given_value"==a.way&&(i=e,e=a.value,e=e>b?b:e);for(h=0;h<=i;h++)(!f||!n.call(this,"v",this.x,this.y+h*e))&&this.gridlines.push({x1:this.x,y1:this.y+h*e,x2:this.x+c,y2:this.y+h*e})}}});iChart.Coordinate3D=iChart.extend(iChart.Coordinate2D,{configure:function(){iChart.Coordinate3D.superclass.configure.apply(this,arguments);this.type="coordinate3d";this.dimension=iChart._3D;this.set({xAngle:60,yAngle:20,xAngle_:void 0,yAngle_:void 0,zHeight:0,pedestal_height:22,board_deep:20,gradient:!0,color_factor:0.18,ignoreEdge:!0,alternate_color:!1,grid_color:"#7a8d44",background_color:"#d6dbd2",shadow_offsetx:4,shadow_offsety:2,wall_style:[],axis:{enable:!1}})},doDraw:function(){var a=this.get("width"),d=this.get("height"),f=this.get("xAngle_"),e=this.get("yAngle_"),b=this.get("zHeight"),c=f*b,j=e*b,g=this.gridlines;this.T.cube3D(this.x,this.y+d+this.get("pedestal_height"),f,e,!1,a,this.get("pedestal_height"),3*b/2,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("bottom_style"));this.T.cube3D(this.x+this.get("board_deep")*f,this.y+d-this.get("board_deep")*e,f,e,!1,a,d,b,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("board_style"));this.T.cube3D(this.x,this.y+d,f,e,!1,a,d,b,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("wall_style"));for(a=0;a<g.length;a++)this.T.line(g[a].x1,g[a].y1,g[a].x1+c,g[a].y1-j,this.get("grid_line_width"),this.get("grid_color")),this.T.line(g[a].x1+c,g[a].y1-j,g[a].x2+c,g[a].y2-j,this.get("grid_line_width"),this.get("grid_color"));for(a=0;a<this.scale.length;a++)this.scale[a].draw()},doConfig:function(){iChart.Coordinate3D.superclass.doConfig.call(this);var a=this.get("background_color"),d=iChart.dark(a,0.1),f=this.get("height"),e=this.get("width");3>this.get("wall_style").length&&this.push("wall_style",[{color:d},{color:a},{color:d}]);var b=this.get("wall_style")[0].color;this.push("bottom_style",[{color:a,shadow:this.get("shadow"),shadowColor:this.get("shadow_color"),blur:this.get("shadow_blur"),sx:this.get("shadow_offsetx"),sy:this.get("shadow_offsety")},!1,!1,{color:b},{color:b},{color:b}]);this.push("board_style",[!1,!1,!1,{color:b},{color:a},!1]);if(this.get("gradient")){var c=this.get("xAngle_")*this.get("zHeight"),j=this.get("yAngle_")*this.get("zHeight"),g=this.get("wall_style"),h=this.get("bottom_style");iChart.isString(g[0].color)&&(g[0].color=this.T.avgLinearGradient(this.x,this.y+f,this.x+e,this.y+f,[b,this.get("dark_color")]));iChart.isString(g[1].color)&&(g[1].color=this.T.avgLinearGradient(this.x+c,this.y-j,this.x+c,this.y+f-j,[this.get("dark_color"),this.get("light_color")]));iChart.isString(g[2].color)&&(g[2].color=this.T.avgLinearGradient(this.x,this.y,this.x,this.y+f,[a,this.get("dark_color")]));h[5].color=this.T.avgLinearGradient(this.x,this.y+f,this.x,this.y+f+this.get("pedestal_height"),[a,d])}}});