iChart.Scale=iChart.extend(iChart.Component,{configure:function(){iChart.Scale.superclass.configure.apply(this,arguments);this.type="scale";this.set({position:"left",which:"h",distance:void 0,start_scale:0,end_scale:void 0,min_scale:void 0,max_scale:void 0,scale_space:void 0,scale_share:5,scale_enable:!0,scale_size:1,scale_width:4,scale_color:"#333333",scaleAlign:"center",labels:[],scale2grid:!0,text_height:16,text_space:4,textAlign:"left",decimalsnum:0,join_style:"none",join_size:2});this.registerEvent("parseText");this.items=[];this.number=0},isEventValid:function(){return{valid:!1}},doDraw:function(){var a=0,g=0,e=0,d=0,f=0,c=0,h=this.get("scale_width"),i=h/2,b=this.get("scaleAlign"),m=this.get("textAlign"),l=this.get("text_space");this.isH?("top"==b?g=-h:"center"==b?(g=-i,d=i):d=h,this.T.textAlign("center"),"top"==m)?(c=-l,this.T.textBaseline("bottom")):(c=l,this.T.textBaseline("top")):("left"==b?a=-h:"center"==b?(a=-i,e=i):e=h,this.T.textBaseline("middle"),"right"==m)?(this.T.textAlign("left"),f=l):(this.T.textAlign("right"),f=-l);this.T.textFont(this.get("fontStyle"));for(h=0;h<this.items.length;h++)this.get("scale_enable")&&this.T.line(this.items[h].x+a,this.items[h].y+g,this.items[h].x+e,this.items[h].y+d,this.get("scale_size"),this.get("scale_color"),!1),this.T.fillText(this.items[h].text,this.items[h].textX+f,this.items[h].textY+c,!1,this.get("color"),"lr",this.get("text_height"))},doConfig:function(){iChart.Scale.superclass.doConfig.call(this);iChart.Assert.isNumber(this.get("distance"),"distance");var a=this.get("labels").length,g=this.get("min_scale"),e=this.get("max_scale"),d=this.get("scale_space"),f=this.get("end_scale"),c=this.get("start_scale");if(0<a)this.number=a-1;else{iChart.Assert.isTrue(iChart.isNumber(e)||iChart.isNumber(f),"max_scale&end_scale");if(!f||f<e)f=this.push("end_scale",iChart.ceil(e));c>g&&this.push("start_scale",iChart.floor(g));d&&d<f-c&&this.push("scale_share",(f-c)/d);if(!d||d>f-c)d=this.push("scale",(f-c)/this.get("scale_share"));this.number=this.get("scale_share");if(1>d&&0==this.get("decimalsnum"))for(g=d;1>g;)g*=10,this.push("decimalsnum",this.get("decimalsnum")+1)}this.push("distanceOne",this.get("valid_distance")/this.number);var g=0,h;this.T.textFont(this.get("fontStyle"));this.push("which",this.get("which").toLowerCase());this.isH="h"==this.get("which");for(var i=0;i<=this.number;i++)e=a?this.get("labels")[i]:(d*i+c).toFixed(this.get("decimalsnum")),f=this.isH?this.get("valid_x")+i*this.get("distanceOne"):this.x,h=this.isH?this.y:this.get("valid_y")+this.get("distance")-i*this.get("distanceOne"),this.items.push(iChart.merge({text:e,x:f,y:h,textX:f,textY:h},this.fireEvent(this,"parseText",[e,f,h,i]))),g=Math.max(g,this.T.measureText(e));this.left=this.right=this.top=this.bottom=0;a=this.get("text_space");d=this.get("textAlign");c=this.get("scaleAlign");e=this.get("scale_width");f=e/2;this.isH?(this.top="top"==c?e:"center"==c?f:0,this.bottom=e-this.top,"top"==d?this.top+=this.get("text_height")+a:this.bottom+=this.get("text_height")+a):(this.left="left"==c?e:"center"==c?f:0,this.right=e-this.left,"left"==d?this.left+=g+a:this.right+=g+a)}});iChart.Coordinate2D=iChart.extend(iChart.Component,{configure:function(){iChart.Coordinate2D.superclass.configure.apply(this,arguments);this.type="coordinate2d";this.set({sign_size:12,sign_space:5,scale:[],valid_width:void 0,valid_height:void 0,grid_line_width:1,grid_color:"#dbe1e1",gridlinesVisible:!0,scale2grid:!0,grids:void 0,ignoreOverlap:!0,ignoreEdge:!1,xlabel:"",ylabel:"",alternate_color:!0,alternate_direction:"v",alternate_color_factor:0.01,crosshair:{enable:!1},width:void 0,height:void 0,axis:{enable:!0,color:"#666666",width:1}});this.registerEvent();this.scale=[];this.gridlines=[]},getScale:function(a){for(var g=0;g<this.scale.length;g++){var e=this.scale[g];if(e.get("position")==a)return{start:e.get("start_scale"),end:e.get("end_scale"),distance:e.get("end_scale")-e.get("start_scale")}}return{start:0,end:0,distance:0}},isEventValid:function(a){return{valid:a.offsetX>this.x&&a.offsetX<this.x+this.get("width")&&a.offsetY<this.y+this.get("height")&&a.offsetY>this.y}},doDraw:function(){this.T.rectangle(this.x,this.y,this.get("width"),this.get("height"),this.get("f_color"));if(this.get("alternate_color")){var a,g,e=!1,d=[0,0,0,0],f=iChart.dark(this.get("f_color"),this.get("alternate_color_factor"));this.get("axis.enable")&&(d=this.get("axis.width"))}for(var c=this.gridlines,h=this.get("grid_line_width"),i="v"==this.get("alternate_direction"),b=0;b<c.length;b++)c[b].x1=Math.round(c[b].x1),c[b].y1=Math.round(c[b].y1),c[b].x2=Math.round(c[b].x2),c[b].y2=Math.round(c[b].y2),this.get("alternate_color")&&(e&&(i?this.T.rectangle(c[b].x1+d[3],c[b].y1+h,c[b].x2-c[b].x1-d[3]-d[1],g-c[b].y1-h,f):this.T.rectangle(a+h,c[b].y2+d[0],c[b].x1-a,c[b].y1-c[b].y2-d[0]-d[2],f)),a=c[b].x1,g=c[b].y1,e=!e),this.T.line(c[b].x1,c[b].y1,c[b].x2,c[b].y2,h,this.get("grid_color"));this.T.rectangle(this.x,this.y,this.get("width"),this.get("height"),!1,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("shadow"),this.get("shadow_color"),this.get("shadow_blur"),this.get("shadow_offsetx"),this.get("shadow_offsety"));for(b=0;b<this.scale.length;b++)this.scale[b].draw()},doConfig:function(){iChart.Coordinate2D.superclass.doConfig.call(this);iChart.Assert.isNumber(this.get("width"),"width");iChart.Assert.isNumber(this.get("height"),"height");this.atomic=!1;this.get("gradient")&&iChart.isString(this.get("background_color"))&&this.push("f_color",this.T.avgLinearGradient(this.x,this.y,this.x,this.y+this.get("height"),[this.get("dark_color"),this.get("light_color")]));if(this.get("axis.enable")){var a=this.get("axis.width");iChart.isArray(a)||this.push("axis.width",[a,a,a,a])}this.get("crosshair.enable")&&(this.push("crosshair.wrap",this.container.shell),this.push("crosshair.height",this.get("height")),this.push("crosshair.width",this.get("width")),this.push("crosshair.top",this.y),this.push("crosshair.left",this.x),this.crosshair=new iChart.CrossHair(this.get("crosshair"),this));var g,e=!(!this.get("gridlinesVisible")||!this.get("grids")),a=e&&!!this.get("grids.horizontal"),d=e&&!!this.get("grids.vertical"),f=this.get("height"),c=this.get("width"),h=this.get("valid_width"),i=this.get("valid_height"),b=this.get("gridlinesVisible")&&this.get("scale2grid")&&!(a&&d),m=(c-h)/2,l=(f-i)/2,n=this.get("axis.width");iChart.isArray(this.get("scale"))||(iChart.isObject(this.get("scale"))?this.push("scale",[this.get("scale")]):this.push("scale",[]));this.get("scale").each(function(a){g=(g=a.position)||"left";g=g.toLowerCase();a.originx=this.x;a.originy=this.y;a.valid_x=this.x+m;a.valid_y=this.y+l;a.position=g;if(g=="top"){a.which="h";a.distance=c;a.valid_distance=h}else if(g=="right"){a.which="v";a.distance=f;a.valid_distance=i;a.originx=a.originx+c;a.valid_x=a.valid_x+h}else if(g=="bottom"){a.which="h";a.distance=c;a.valid_distance=h;a.originy=a.originy+f;a.valid_y=a.valid_y+i}else{a.which="v";a.distance=f;a.valid_distance=i}this.scale.push(new iChart.Scale(a,this.container))},this);if(e=this.push("ignoreOverlap",this.get("ignoreOverlap")&&this.get("axis.enable")||this.get("ignoreEdge")))var q=this.get("ignoreEdge")?function(a,b,c){return a=="v"?c==this.y||c==this.y+f:b==this.x||b==this.x+a}:function(a,b,d){return a=="v"?d==this.y&&n[0]>0||d==this.y+f&&n[2]>0:b==this.x&&n[3]>0||b==this.x+c&&n[1]>0};if(b)for(var j,o,p,b=0;b<this.scale.length;b++)if(j=this.scale[b],!iChart.isFalse(j.get("scale2grid"))&&!(a&&"v"==j.get("which")||d&&"h"==j.get("which"))){o=p=0;"top"==j.get("position")?p=f:"right"==j.get("position")?o=-c:"bottom"==j.get("position")?p=-f:o=c;for(var k=0;k<j.items.length;k++)(!e||!q.call(this,j.get("which"),j.items[k].x,j.items[k].y))&&this.gridlines.push({x1:j.items[k].x,y1:j.items[k].y,x2:j.items[k].x+o,y2:j.items[k].y+p})}if(d){b=this.get("grids.vertical");iChart.Assert.gtZero(b.value,"value");d=c/b.value;j=b.value;"given_value"==b.way&&(j=d,d=b.value,d=d>c?c:d);for(b=0;b<=j;b++)(!e||!q.call(this,"h",this.x+b*d,this.y))&&this.gridlines.push({x1:this.x+b*d,y1:this.y,x2:this.x+b*d,y2:this.y+f})}if(a){a=this.get("grids.horizontal");iChart.Assert.gtZero(a.value,"value");d=f/a.value;j=a.value;"given_value"==a.way&&(j=d,d=a.value,d=d>f?f:d);for(b=0;b<=j;b++)(!e||!q.call(this,"v",this.x,this.y+b*d))&&this.gridlines.push({x1:this.x,y1:this.y+b*d,x2:this.x+c,y2:this.y+b*d})}}});iChart.Coordinate3D=iChart.extend(iChart.Coordinate2D,{configure:function(){iChart.Coordinate3D.superclass.configure.apply(this,arguments);this.type="coordinate3d";this.dimension=iChart._3D;this.set({xAngle:60,yAngle:20,xAngle_:void 0,yAngle_:void 0,zHeight:0,pedestal_height:22,board_deep:20,gradient:!0,color_factor:0.18,ignoreEdge:!0,alternate_color:!1,grid_color:"#7a8d44",background_color:"#d6dbd2",shadow_offsetx:4,shadow_offsety:2,wall_style:[],axis:{enable:!1}})},doDraw:function(){var a=this.get("width"),g=this.get("height"),e=this.get("xAngle_"),d=this.get("yAngle_"),f=this.get("zHeight"),c=e*f,h=d*f,i=this.gridlines;this.T.cube3D(this.x,this.y+g+this.get("pedestal_height"),e,d,!1,a,this.get("pedestal_height"),3*f/2,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("bottom_style"));this.T.cube3D(this.x+this.get("board_deep")*e,this.y+g-this.get("board_deep")*d,e,d,!1,a,g,f,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("board_style"));this.T.cube3D(this.x,this.y+g,e,d,!1,a,g,f,this.get("axis.enable"),this.get("axis.width"),this.get("axis.color"),this.get("wall_style"));for(a=0;a<i.length;a++)this.T.line(i[a].x1,i[a].y1,i[a].x1+c,i[a].y1-h,this.get("grid_line_width"),this.get("grid_color")),this.T.line(i[a].x1+c,i[a].y1-h,i[a].x2+c,i[a].y2-h,this.get("grid_line_width"),this.get("grid_color"));for(a=0;a<this.scale.length;a++)this.scale[a].draw()},doConfig:function(){iChart.Coordinate3D.superclass.doConfig.call(this);var a=this.get("background_color"),g=iChart.dark(a,0.1),e=this.get("height"),d=this.get("width");3>this.get("wall_style").length&&this.push("wall_style",[{color:g},{color:a},{color:g}]);var f=this.get("wall_style")[0].color;this.push("bottom_style",[{color:a,shadow:this.get("shadow"),shadowColor:this.get("shadow_color"),blur:this.get("shadow_blur"),sx:this.get("shadow_offsetx"),sy:this.get("shadow_offsety")},!1,!1,{color:f},{color:f},{color:f}]);this.push("board_style",[!1,!1,!1,{color:f},{color:a},!1]);if(this.get("gradient")){var c=this.get("xAngle_")*this.get("zHeight"),h=this.get("yAngle_")*this.get("zHeight"),i=this.get("wall_style"),b=this.get("bottom_style");iChart.isString(i[0].color)&&(i[0].color=this.T.avgLinearGradient(this.x,this.y+e,this.x+d,this.y+e,[f,this.get("dark_color")]));iChart.isString(i[1].color)&&(i[1].color=this.T.avgLinearGradient(this.x+c,this.y-h,this.x+c,this.y+e-h,[this.get("dark_color"),this.get("light_color")]));iChart.isString(i[2].color)&&(i[2].color=this.T.avgLinearGradient(this.x,this.y,this.x,this.y+e,[a,this.get("dark_color")]));b[5].color=this.T.avgLinearGradient(this.x,this.y+e,this.x,this.y+e+this.get("pedestal_height"),[a,g])}}});