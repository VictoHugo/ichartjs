iChart.Scale=iChart.extend(iChart.Component,{configure:function(){iChart.Scale.superclass.configure.apply(this,arguments);this.type="scale";this.set({position:"left",which:"h",basic_value:0,scale2grid:!0,distance:void 0,start_scale:0,end_scale:void 0,min_scale:void 0,max_scale:void 0,scale_space:void 0,scale_share:5,scale_enable:!0,scale_size:1,scale_width:4,scale_color:"#333333",scaleAlign:"center",labels:[],label:{},text_space:6,textAlign:"left",decimalsnum:0,join_style:"none",join_size:2});this.registerEvent("parseText")},isEventValid:function(){return{valid:!1}},getScale:function(a){a=[a.get("basic_value"),a.get("start_scale"),a.get("end_scale"),a.get("end_scale")-a.get("start_scale"),0];a[4]=iChart.inRange(a[1],a[2]+1,a[0])||iChart.inRange(a[2]-1,a[1],a[0]);return{range:a[4],basic:a[4]?(a[0]-a[1])/a[3]:0,start:a[4]?a[0]:a[1],end:a[2],distance:a[3]}},doDraw:function(a){a.get("scale_enable")&&a.items.each(function(b){a.T.line(b.x0,b.y0,b.x1,b.y1,a.get("scale_size"),a.get("scale_color"),!1)});a.labels.each(function(a){a.draw()})},doLayout:function(a,b,e){e.get("scale_enable")&&e.items.each(function(d){d.x0+=a;d.y0+=b;d.x1+=a;d.y1+=b});e.labels.each(function(d){d.doLayout(a,b,0,d)})},doConfig:function(){iChart.Scale.superclass.doConfig.call(this);var a=this._(),b=Math.abs,e=a.get("labels").length,d=a.get("min_scale"),i=a.get("max_scale"),f=a.get("scale_space"),c=a.get("end_scale"),g=a.get("start_scale");a.items=[];a.labels=[];a.number=0;if(0<e)a.number=e-1;else{g>d&&(g=a.push("start_scale",iChart.floor(d)));if(!iChart.isNumber(c)||c<i)c=iChart.ceil(i),c=a.push("end_scale",!c&&!g?1:c);f&&b(f)<b(c-g)&&a.push("scale_share",(c-g)/f);a.number=a.push("scale_share",b(a.get("scale_share")));if(!f||f>c-g){f=(c-g+"").indexOf(".")+1;for(b=1;0<f;)f--,b*=10;f=a.push("scale",(c-g)*b/a.get("scale_share")/b)}parseInt(f)!=f&&0==a.get("decimalsnum")&&a.push("decimalsnum",(f+"").substring((f+"").indexOf(".")+1).length)}a.push("distanceOne",a.get("valid_distance")/a.number);var l,m,n,p=i=d=b=c=0,q=0;l=a.get("scale_width");m=l/2;n=a.get("scaleAlign");var o=a.get("position"),k=a.get("text_space"),r="",s=a.get("coo").get("axis.width");a.push("which",a.get("which").toLowerCase());a.isH="h"==a.get("which");a.isH?(n==a.O?i=-l:n==a.C?(i=-m,b=m):b=l,o==a.O?(q=-k-s[0],r=a.B):(q=k+s[2],r=a.O),o=a.C):(n==a.L?d=-l:n==a.C?(d=-m,c=m):c=l,r="middle",o==a.R)?(o=a.L,p=k+s[1]):(o=a.R,p=-k-s[3]);for(k=0;k<=a.number;k++)l=e?a.get("labels")[k]:(f*k+g).toFixed(a.get("decimalsnum")),m=a.isH?a.get("valid_x")+k*a.get("distanceOne"):a.x,n=a.isH?a.y:a.get("valid_y")+a.get("valid_distance")-k*a.get("distanceOne"),a.items.push({x:m,y:n,x0:m+d,y0:n+i,x1:m+c,y1:n+b}),a.get("label")&&a.labels.push(new iChart.Text(iChart.applyIf(iChart.apply(a.get("label"),iChart.merge({text:l,x:m,y:n,originx:m+p,originy:n+q},a.fireEvent(a,"parseText",[l,m+p,n+q,k,a.number==k]))),{textAlign:o,textBaseline:r}),a))}});iChart.Coordinate={coordinate_:function(a){var b=this._(),e=b.get("coordinate");if(e.ICHARTJS_OBJECT)return b.ILLUSIVE_COO=!0,e;var e=iChart.parsePercent,d=b.get("coordinate.scale"),i=b.get("scaleAlign"),f=b.push("coordinate._width",e(b.get("coordinate.width")||"85%",Math.floor(b.get("client_width"))));h=b.push("coordinate._height",e(b.get("coordinate.height")||"85%",Math.floor(b.get("client_height")))-(b.is3D()?(b.get("coordinate.pedestal_height")||22)+(b.get("coordinate.board_deep")||20):0));b.push("coordinate.valid_height_value",e(b.get("coordinate.valid_height"),h));b.push("coordinate.valid_width_value",e(b.get("coordinate.valid_width"),f));b.originXY(b,[b.get("l_originx"),b.get("r_originx")-f,b.get("centerx")-f/2],[b.get("centery")-h/2]);b.push("coordinate.originx",b.x);b.push("coordinate.originy",b.y);a&&a();iChart.isObject(d)&&(d=[d]);if(iChart.isArray(d)){var c="stacked"!=b.dataType;d.each(function(a){b.get("percent")&&a.position==i&&(a=iChart.apply(a,{start_scale:0,end_scale:100,scale_space:10,listeners:{parseText:function(a){return{text:a+"%"}}}}));if(!a.start_scale||c&&a.start_scale>b.get("minValue"))a.min_scale=b.get("minValue");if(!a.end_scale||c&&a.end_scale<b.get("maxValue"))a.max_scale=b.get("maxValue")})}else b.push("coordinate.scale",{position:i,scaleAlign:i,max_scale:b.get("maxValue"),min_scale:b.get("minValue")});b.is3D()&&(b.push("coordinate.xAngle_",b.get("xAngle_")),b.push("coordinate.yAngle_",b.get("yAngle_")),b.push("coordinate.zHeight",b.get("zHeight")*b.get("bottom_scale")));b.remove(b,b.coo);return b.register(new (iChart[b.is3D()?"Coordinate3D":"Coordinate2D"])(b.get("coordinate"),b))}};iChart.Coordinate2D=iChart.extend(iChart.Component,{configure:function(){iChart.Coordinate2D.superclass.configure.apply(this,arguments);this.type="coordinate2d";this.set({sign_size:12,sign_space:5,scale:[],width:"80%",height:"80%",valid_width:"100%",valid_height:"100%",grid_line_width:1,grid_color:"#dbe1e1",gridHStyle:{},gridVStyle:{},gridlinesVisible:!0,scale2grid:!0,grids:void 0,ignoreOverlap:!0,ignoreEdge:!1,xlabel:"",ylabel:"",background_color:0,striped:!0,striped_direction:"v",striped_factor:0.01,crosshair:{enable:!1},width:void 0,height:void 0,z_index:-1,axis:{enable:!0,color:"#666666",width:1}});this.scale=[];this.gridlines=[]},getScale:function(a,b){for(var e=this._(),d=0;d<e.scale.length;d++)if(e.scale[d].get("position")==a)return e.scale[d].getScale(e.scale[d]);if(!b)return a=a==e.L?e.R:a==e.R?e.L:a==e.O?e.B:e.O,e.getScale(a,!0);throw Error("there no valid scale");},isEventValid:function(a,b){return{valid:a.x>b.x&&a.x<b.x+b.width&&a.y<b.y+b.height&&a.y>b.y}},doDraw:function(a){a.T.box(a.x,a.y,a.width,a.height,0,a.get("f_color"));if(a.get("striped")){var b,e,d=!1;a.get("axis.width");var i=iChart.dark(a.get("background_color"),a.get("striped_factor"),0)}var f="v"==a.get("striped_direction");a.gridlines.each(function(c){a.get("striped")&&(d&&(f?a.T.box(c.x1,c.y1+c.width,c.x2-c.x1,e-c.y1-c.width,0,i):a.T.box(b+c.width,c.y2,c.x1-b,c.y1-c.y2,0,i)),b=c.x1,e=c.y1,d=!d)}).each(function(b){b.overlap||(b.solid?a.T.line(b.x1,b.y1,b.x2,b.y2,b.width,b.color):a.T.dotted(b.x1,b.y1,b.x2,b.y2,b.width,b.color,b.size,b.fator))});a.T.box(a.x,a.y,a.width,a.height,a.get("axis"),!1,a.get("shadow"),!0);a.scale.each(function(a){a.draw()})},destroy:function(){this.crosshair&&this.crosshair.destroy()},doCrosshair:function(a){a.get("crosshair.enable")&&!a.crosshair&&(a.push("crosshair.wrap",a.root.shell),a.push("crosshair.height",a.height),a.push("crosshair.width",a.width),a.push("crosshair.top",a.y),a.push("crosshair.left",a.x),a.crosshair=new iChart.CrossHair(a.get("crosshair"),a))},doConfig:function(){iChart.Coordinate2D.superclass.doConfig.call(this);var a=this._();a.atomic=!1;a.width=a.get("_width");a.height=a.get("_height");a.valid_width=a.get("valid_width_value");a.valid_height=a.get("valid_height_value");a.get("gradient")&&iChart.isString(a.get("f_color"))&&a.push("f_color",a.T.avgLinearGradient(a.x,a.y,a.x,a.y+a.height,[a.get("dark_color"),a.get("light_color")]));if(a.get("axis.enable")){var b=a.get("axis.width");iChart.isArray(b)||a.push("axis.width",[b,b,b,b])}else a.push("axis.width",[0,0,0,0]);a.doCrosshair(a);var e,d=(b=!(!a.get("gridlinesVisible")||!a.get("grids")))&&!!a.get("grids.horizontal"),i=b&&!!a.get("grids.vertical"),f=a.height,c=a.width,g=a.valid_width,l=a.valid_height,b=a.get("gridlinesVisible")&&a.get("scale2grid")&&!(d&&i),m=a.push("x_start",a.x+(c-g)/2),n=a.push("y_start",a.y+(f-l)/2),p=a.get("axis.width");a.push("x_end",a.x+(c+g)/2);a.push("y_end",a.y+(f+l)/2);iChart.isArray(a.get("scale"))||(iChart.isObject(a.get("scale"))?a.push("scale",[a.get("scale")]):a.push("scale",[]));a.get("scale").each(function(b){e=(e=b.position)||a.L;e=e.toLowerCase();b[a.X]=a.x;b.coo=a;b[a.Y]=a.y;b.valid_x=m;b.valid_y=n;b.position=e;e==a.O?(b.which="h",b.distance=c,b.valid_distance=g):e==a.R?(b.which="v",b.distance=f,b.valid_distance=l,b[a.X]+=c,b.valid_x+=g):e==a.B?(b.which="h",b.distance=c,b.valid_distance=g,b[a.Y]+=f,b.valid_y+=l):(b.which="v",b.distance=f,b.valid_distance=l);a.scale.push(new iChart.Scale(b,a.root))},a);var q=a.push("ignoreOverlap",a.get("ignoreOverlap")&&a.get("axis.enable")||a.get("ignoreEdge"));if(q)var o=a.get("ignoreEdge")?function(b,c,l){return"v"==b?l==a.y||l==a.y+f:c==a.x||c==a.x+b}:function(b,l,d){return"v"==b?d==a.y&&0<p[0]||d==a.y+f&&0<p[2]:l==a.x&&0<p[3]||l==a.x+c&&0<p[1]};var k={solid:!0,size:10,fator:1,width:a.get("grid_line_width"),color:a.get("grid_color")},r=iChart.applyIf(a.get("gridHStyle"),k),s=iChart.applyIf(a.get("gridVStyle"),k);if(b){var t,u,v;a.scale.each(function(b){v=b.get("position");if(!iChart.isFalse(b.get("scale2grid"))&&!(d&&"v"==b.get("which")||i&&"h"==b.get("which")))t=u=0,v==a.O?u=f:v==a.R?t=-c:v==a.B?u=-f:t=c,b.items.each(function(c){q&&a.gridlines.push(iChart.applyIf({overlap:o.call(a,b.get("which"),c.x,c.y),x1:c.x,y1:c.y,x2:c.x+t,y2:c.y+u},b.isH?s:r))})})}if(i){var j=a.get("grids.vertical");iChart.Assert.isTrue(0<j.value,"vertical value");b=c/j.value;k=j.value;"given_value"==j.way&&(k=b,b=j.value,b=b>c?c:b);for(j=0;j<=k;j++)q&&a.gridlines.push(iChart.applyIf({overlap:o.call(a,"h",a.x+j*b,a.y),x1:a.x+j*b,y1:a.y,x2:a.x+j*b,y2:a.y+f,H:!1,width:s.width,color:s.color},s))}if(d){j=a.get("grids.horizontal");iChart.Assert.isTrue(0<j.value,"horizontal value");b=f/j.value;k=j.value;"given_value"==j.way&&(k=b,b=j.value,b=b>f?f:b);for(j=0;j<=k;j++)q&&a.gridlines.push(iChart.applyIf({overlap:o.call(a,"v",a.x,a.y+j*b),x1:a.x,y1:a.y+j*b,x2:a.x+c,y2:a.y+j*b,H:!0,width:r.width,color:r.color},r))}}});iChart.Coordinate3D=iChart.extend(iChart.Coordinate2D,{configure:function(){iChart.Coordinate3D.superclass.configure.apply(this,arguments);this.type="coordinate3d";this.dimension=iChart._3D;this.set({xAngle:60,yAngle:20,xAngle_:void 0,yAngle_:void 0,zHeight:0,pedestal_height:22,board_deep:20,left_board:!0,gradient:!0,color_factor:0.18,ignoreEdge:!0,striped:!1,grid_color:"#a4ad96",background_color:"#d6dbd2",shadow_offsetx:4,shadow_offsety:2,wall_style:[],axis:{enable:!1}})},doDraw:function(a){var b=a.width,e=a.height,d=a.get("xAngle_"),i=a.get("yAngle_"),f=a.get("zHeight"),c=a.get("z_offx"),g=a.get("z_offy");a.get("pedestal_height")&&a.T.cube3D(a.x,a.y+e+a.get("pedestal_height"),d,i,!1,b,a.get("pedestal_height"),3*f/2,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("bottom_style"));a.get("board_deep")&&a.T.cube3D(a.x+c,a.y+e-g,d,i,!1,b,e,a.get("board_deep"),a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("board_style"));a.T.cube3D(a.x,a.y+e,d,i,!1,b,e,f,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("wall_style"));a.gridlines.each(function(b){b.solid?(a.get("left_board")&&a.T.line(b.x1,b.y1,b.x1+c,b.y1-g,b.width,b.color),a.T.line(b.x1+c,b.y1-g,b.x2+c,b.y2-g,b.width,b.color)):(a.get("left_board")&&a.T.dotted(b.x1,b.y1,b.x1+c,b.y1-g,b.width,b.color,b.size,b.fator),a.T.dotted(b.x1+c,b.y1-g,b.x2+c,b.y2-g,b.width,b.color,b.size,b.fator))});a.scale.each(function(a){a.draw()})},doConfig:function(){iChart.Coordinate3D.superclass.doConfig.call(this);for(var a=this._(),b=a.get("wall_style"),e=a.get("background_color")||"#d6dbd2",d=a.height,i=a.width,f=a.get("color_factor"),c=a.push("z_offx",a.get("xAngle_")*a.get("zHeight")),g=a.push("z_offy",a.get("yAngle_")*a.get("zHeight"));6>b.length;)b.push({color:e});a.get("left_board")||(b[2]=!1,a.scale.each(function(a){a.doLayout(c,-g,a)}));a.push("bottom_style",[{color:a.get("shadow_color"),shadow:a.get("shadow")},!1,!1,{color:b[3].color},!1,{color:b[3].color}]);a.push("board_style",[!1,!1,!1,{color:b[4].color},{color:b[5].color},!1]);a.get("gradient")&&(iChart.isString(b[0].color)&&(b[0].color=a.T.avgLinearGradient(a.x,a.y+d,a.x+i,a.y+d,[iChart.dark(b[0].color,f/2+0.06),iChart.dark(b[0].color,f/2+0.06)])),iChart.isString(b[1].color)&&(b[1].color=a.T.avgLinearGradient(a.x+c,a.y-g,a.x+c,a.y+d-g,[iChart.dark(b[1].color,f),iChart.light(b[1].color,f)])),iChart.isString(b[2].color)&&(b[2].color=a.T.avgLinearGradient(a.x,a.y,a.x,a.y+d,[iChart.light(b[2].color,f/3),iChart.dark(b[2].color,f)])),a.get("bottom_style")[5].color=a.T.avgLinearGradient(a.x,a.y+d,a.x,a.y+d+a.get("pedestal_height"),[iChart.light(b[3].color,f/2+0.06),iChart.dark(b[3].color,f/2,0)]));a.push("wall_style",[b[0],b[1],b[2]])}});