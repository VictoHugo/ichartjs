iChart.Scale=iChart.extend(iChart.Component,{configure:function(){iChart.Scale.superclass.configure.apply(this,arguments);this.type="scale";this.set({position:"left",which:"h",distance:void 0,start_scale:0,end_scale:void 0,min_scale:void 0,max_scale:void 0,scale_space:void 0,scale_share:5,scale_enable:!0,scale_size:1,scale_width:4,scale_color:"#333333",scaleAlign:"center",labels:[],scale2grid:!0,text_height:16,text_space:4,textAlign:"left",decimalsnum:0,join_style:"none",join_size:2});this.registerEvent("parseText");this.items=[];this.number=0},isEventValid:function(){return{valid:!1}},doDraw:function(){var a=this._(),d=0,e=0,h=0,b=0,f=0,g=0,j=a.get("scale_width"),c=j/2,i=a.get("scaleAlign"),m=a.get("textAlign"),n=a.get("text_space");a.isH?("top"==i?e=-j:"center"==i?(e=-c,b=c):b=j,a.T.textAlign("center"),"top"==m)?(g=-n,a.T.textBaseline("bottom")):(g=n,a.T.textBaseline("top")):("left"==i?d=-j:"center"==i?(d=-c,h=c):h=j,a.T.textBaseline("middle"),"right"==m)?(a.T.textAlign("left"),f=n):(a.T.textAlign("right"),f=-n);a.T.textFont(a.get("fontStyle"));a.items.each(function(c){a.get("scale_enable")&&a.T.line(c.x+d,c.y+e,c.x+h,c.y+b,a.get("scale_size"),a.get("scale_color"),!1);a.T.fillText(c.text,c.textX+f,c.textY+g,!1,a.get("color"),"lr",a.get("text_height"))})},doConfig:function(){iChart.Scale.superclass.doConfig.call(this);iChart.Assert.isNumber(this.get("distance"),"distance");var a=this._(),d=a.get("labels").length,e=a.get("min_scale"),h=a.get("max_scale"),b=a.get("scale_space"),f=a.get("end_scale"),g=a.get("start_scale");if(0<d)a.number=d-1;else{iChart.Assert.isTrue(iChart.isNumber(h)||iChart.isNumber(f),"max_scale&end_scale");if(!f||f<h)f=a.push("end_scale",iChart.ceil(h));g>e&&a.push("start_scale",iChart.floor(e));b&&b<f-g&&a.push("scale_share",(f-g)/b);if(!b||b>f-g)b=a.push("scale",(f-g)/a.get("scale_share"));a.number=a.get("scale_share");if(1>b&&0==a.get("decimalsnum"))for(e=b;1>e;)e*=10,a.push("decimalsnum",a.get("decimalsnum")+1)}a.push("distanceOne",a.get("valid_distance")/a.number);var e=0,j;a.T.textFont(a.get("fontStyle"));a.push("which",a.get("which").toLowerCase());a.isH="h"==a.get("which");for(var c=0;c<=a.number;c++)h=d?a.get("labels")[c]:(b*c+g).toFixed(a.get("decimalsnum")),f=a.isH?a.get("valid_x")+c*a.get("distanceOne"):a.x,j=a.isH?a.y:a.get("valid_y")+a.get("distance")-c*a.get("distanceOne"),a.items.push(iChart.merge({text:h,x:f,y:j,textX:f,textY:j},a.fireEvent(a,"parseText",[h,f,j,c]))),e=Math.max(e,a.T.measureText(h));a.left=a.right=a.top=a.bottom=0;d=a.get("text_space");b=a.get("textAlign");g=a.get("scaleAlign");h=a.get("scale_width");f=h/2;a.isH?(a.top="top"==g?h:"center"==g?f:0,a.bottom=h-a.top,"top"==b?a.top+=a.get("text_height")+d:a.bottom+=a.get("text_height")+d):(a.left="left"==g?h:"center"==g?f:0,a.right=h-a.left,"left"==b?a.left+=e+d:a.right+=e+d)}});iChart.Coordinate2D=iChart.extend(iChart.Component,{configure:function(){iChart.Coordinate2D.superclass.configure.apply(this,arguments);this.type="coordinate2d";this.set({sign_size:12,sign_space:5,scale:[],valid_width:void 0,valid_height:void 0,grid_line_width:1,grid_color:"#dbe1e1",gridlinesVisible:!0,scale2grid:!0,grids:void 0,ignoreOverlap:!0,ignoreEdge:!1,xlabel:"",ylabel:"",alternate_color:!0,alternate_direction:"v",alternate_color_factor:0.01,crosshair:{enable:!1},width:void 0,height:void 0,z_index:-1,axis:{enable:!0,color:"#666666",width:1}});this.registerEvent();this.scale=[];this.gridlines=[]},getScale:function(a){for(var d=0;d<this.scale.length;d++){var e=this.scale[d];if(e.get("position")==a)return{start:e.get("start_scale"),end:e.get("end_scale"),distance:e.get("end_scale")-e.get("start_scale")}}return{start:0,end:0,distance:0}},isEventValid:function(a){return{valid:a.x>this.x&&a.x<this.x+this.get("width")&&a.y<this.y+this.get("height")&&a.y>this.y}},doDraw:function(){var a=this._();a.T.box(a.x,a.y,a.get("width"),a.get("height"),0,a.get("f_color"));if(a.get("alternate_color")){var d,e,h=!1,b=[0,0,0,0],f=iChart.dark(a.get("f_color"),a.get("alternate_color_factor"));a.get("axis.enable")&&(b=a.get("axis.width"))}var g=a.get("grid_line_width"),j="v"==a.get("alternate_direction");a.gridlines.each(function(c){c.x1=Math.round(c.x1);c.y1=Math.round(c.y1);c.x2=Math.round(c.x2);c.y2=Math.round(c.y2);a.get("alternate_color")&&(h&&(j?a.T.box(c.x1+b[3],c.y1+g,c.x2-c.x1-b[3]-b[1],e-c.y1-g,0,f):a.T.box(d+g,c.y2+b[0],c.x1-d,c.y1-c.y2-b[0]-b[2],0,f)),d=c.x1,e=c.y1,h=!h);a.T.line(c.x1,c.y1,c.x2,c.y2,g,a.get("grid_color"))});a.T.box(a.x,a.y,a.get("width"),a.get("height"),a.get("axis"),!1,a.get("shadow"));a.scale.each(function(a){a.draw()})},doConfig:function(){iChart.Coordinate2D.superclass.doConfig.call(this);var a=this._();iChart.Assert.isNumber(a.get("width"),"width");iChart.Assert.isNumber(a.get("height"),"height");a.atomic=!1;a.get("gradient")&&iChart.isString(a.get("f_color"))&&a.push("f_color",a.T.avgLinearGradient(a.x,a.y,a.x,a.y+a.get("height"),[a.get("dark_color"),a.get("light_color")]));if(a.get("axis.enable")){var d=a.get("axis.width");iChart.isArray(d)||a.push("axis.width",[d,d,d,d])}a.get("crosshair.enable")&&(a.push("crosshair.wrap",a.container.shell),a.push("crosshair.height",a.get("height")),a.push("crosshair.width",a.get("width")),a.push("crosshair.top",a.y),a.push("crosshair.left",a.x),a.crosshair=new iChart.CrossHair(a.get("crosshair"),a));var e,h=!(!a.get("gridlinesVisible")||!a.get("grids")),d=h&&!!a.get("grids.horizontal"),b=h&&!!a.get("grids.vertical"),f=a.get("height"),g=a.get("width"),j=a.get("valid_width"),c=a.get("valid_height"),i=a.get("gridlinesVisible")&&a.get("scale2grid")&&!(d&&b),m=(g-j)/2,n=(f-c)/2,o=a.get("axis.width");iChart.isArray(a.get("scale"))||(iChart.isObject(a.get("scale"))?a.push("scale",[a.get("scale")]):a.push("scale",[]));a.get("scale").each(function(b){e=(e=b.position)||"left";e=e.toLowerCase();b.originx=a.x;b.originy=a.y;b.valid_x=a.x+m;b.valid_y=a.y+n;b.position=e;if(e=="top"){b.which="h";b.distance=g;b.valid_distance=j}else if(e=="right"){b.which="v";b.distance=f;b.valid_distance=c;b.originx=b.originx+g;b.valid_x=b.valid_x+j}else if(e=="bottom"){b.which="h";b.distance=g;b.valid_distance=j;b.originy=b.originy+f;b.valid_y=b.valid_y+c}else{b.which="v";b.distance=f;b.valid_distance=c}a.scale.push(new iChart.Scale(b,a.container))},a);if(h=a.push("ignoreOverlap",a.get("ignoreOverlap")&&a.get("axis.enable")||a.get("ignoreEdge")))var r=a.get("ignoreEdge")?function(b,c,d){return b=="v"?d==a.y||d==a.y+f:c==a.x||c==a.x+b}:function(b,c,d){return b=="v"?d==a.y&&o[0]>0||d==a.y+f&&o[2]>0:c==a.x&&o[3]>0||c==a.x+g&&o[1]>0};if(i)for(var k,p,q,l,i=0;i<a.scale.length;i++)if(k=a.scale[i],l=k.get("position"),!iChart.isFalse(k.get("scale2grid"))&&!(d&&"v"==k.get("which")||b&&"h"==k.get("which"))){p=q=0;"top"==l?q=f:"right"==l?p=-g:"bottom"==l?q=-f:p=g;for(l=0;l<k.items.length;l++)(!h||!r.call(a,k.get("which"),k.items[l].x,k.items[l].y))&&a.gridlines.push({x1:k.items[l].x,y1:k.items[l].y,x2:k.items[l].x+p,y2:k.items[l].y+q})}if(b){i=a.get("grids.vertical");iChart.Assert.gtZero(i.value,"value");b=g/i.value;k=i.value;"given_value"==i.way&&(k=b,b=i.value,b=b>g?g:b);for(i=0;i<=k;i++)(!h||!r.call(a,"h",a.x+i*b,a.y))&&a.gridlines.push({x1:a.x+i*b,y1:a.y,x2:a.x+i*b,y2:a.y+f})}if(d){d=a.get("grids.horizontal");iChart.Assert.gtZero(d.value,"value");b=f/d.value;k=d.value;"given_value"==d.way&&(k=b,b=d.value,b=b>f?f:b);for(i=0;i<=k;i++)(!h||!r.call(a,"v",a.x,a.y+i*b))&&a.gridlines.push({x1:a.x,y1:a.y+i*b,x2:a.x+g,y2:a.y+i*b})}}});iChart.Coordinate3D=iChart.extend(iChart.Coordinate2D,{configure:function(){iChart.Coordinate3D.superclass.configure.apply(this,arguments);this.type="coordinate3d";this.dimension=iChart._3D;this.set({xAngle:60,yAngle:20,xAngle_:void 0,yAngle_:void 0,zHeight:0,pedestal_height:22,board_deep:20,gradient:!0,color_factor:0.18,ignoreEdge:!0,alternate_color:!1,grid_color:"#7a8d44",background_color:"#d6dbd2",shadow_offsetx:4,shadow_offsety:2,wall_style:[],axis:{enable:!1}})},doDraw:function(){var a=this._(),d=a.get("width"),e=a.get("height"),h=a.get("xAngle_"),b=a.get("yAngle_"),f=a.get("zHeight"),g=h*f,j=b*f;a.T.cube3D(a.x,a.y+e+a.get("pedestal_height"),h,b,!1,d,a.get("pedestal_height"),3*f/2,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("bottom_style"));a.T.cube3D(a.x+a.get("board_deep")*h,a.y+e-a.get("board_deep")*b,h,b,!1,d,e,f,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("board_style"));a.T.cube3D(a.x,a.y+e,h,b,!1,d,e,f,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("wall_style"));a.gridlines.each(function(b){a.T.line(b.x1,b.y1,b.x1+g,b.y1-j,a.get("grid_line_width"),a.get("grid_color"));a.T.line(b.x1+g,b.y1-j,b.x2+g,b.y2-j,a.get("grid_line_width"),a.get("grid_color"))});a.scale.each(function(a){a.draw()})},doConfig:function(){iChart.Coordinate3D.superclass.doConfig.call(this);var a=this._(),d=a.get("background_color"),e=iChart.dark(d,0.1),h=a.get("dark_color"),b=a.get("height"),f=a.get("width");3>a.get("wall_style").length&&a.push("wall_style",[{color:e},{color:d},{color:e}]);var g=a.get("wall_style")[0].color;a.push("bottom_style",[{shadow:a.get("shadow")},!1,!1,{color:g},{color:g},{color:g}]);a.push("board_style",[!1,!1,!1,{color:g},{color:d},!1]);if(a.get("gradient")){var j=a.get("xAngle_")*a.get("zHeight"),c=a.get("yAngle_")*a.get("zHeight"),i=a.get("wall_style"),m=a.get("bottom_style");iChart.isString(i[0].color)&&(i[0].color=a.T.avgLinearGradient(a.x,a.y+b,a.x+f,a.y+b,[g,h]));iChart.isString(i[1].color)&&(i[1].color=a.T.avgLinearGradient(a.x+j,a.y-c,a.x+j,a.y+b-c,[h,a.get("light_color")]));iChart.isString(i[2].color)&&(i[2].color=a.T.avgLinearGradient(a.x,a.y,a.x,a.y+b,[d,h]));m[5].color=a.T.avgLinearGradient(a.x,a.y+b,a.x,a.y+b+a.get("pedestal_height"),[d,e])}}});