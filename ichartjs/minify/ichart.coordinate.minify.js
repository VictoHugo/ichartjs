iChart.Scale=iChart.extend(iChart.Component,{configure:function(){iChart.Scale.superclass.configure.apply(this,arguments);this.type="scale";this.set({position:"left",which:"h",distance:void 0,start_scale:0,end_scale:void 0,min_scale:void 0,max_scale:void 0,scale_space:void 0,scale_share:5,scale_enable:!0,scale_size:1,scale_width:4,scale_color:"#333333",scaleAlign:"center",labels:[],label:{},text_space:6,textAlign:"left",decimalsnum:0,join_style:"none",join_size:2});this.registerEvent("parseText")},isEventValid:function(){return{valid:!1}},doDraw:function(){var a=this._();a.get("scale_enable")&&a.items.each(function(b){a.T.line(b.x0,b.y0,b.x1,b.y1,a.get("scale_size"),a.get("scale_color"),!1)});a.labels.each(function(a){a.draw()})},doConfig:function(){iChart.Scale.superclass.doConfig.call(this);iChart.Assert.isNumber(this.get("distance"),"distance");var a=this._(),b=a.get("labels").length,d=a.get("min_scale"),g=a.get("max_scale"),f=a.get("scale_space"),e=a.get("end_scale"),h=a.get("start_scale");a.items=[];a.labels=[];a.number=0;if(0<b)a.number=b-1;else{iChart.Assert.isTrue(iChart.isNumber(g)||iChart.isNumber(e),"max_scale&end_scale");if(!e||e<g)e=a.push("end_scale",iChart.ceil(g));h>d&&a.push("start_scale",iChart.floor(d));f&&f<e-h&&a.push("scale_share",(e-h)/f);if(!f||f>e-h)f=a.push("scale",(e-h)/a.get("scale_share"));a.number=a.get("scale_share");if(1>f&&0==a.get("decimalsnum"))for(d=f;1>d;)d*=10,a.push("decimalsnum",a.get("decimalsnum")+1)}a.push("distanceOne",a.get("valid_distance")/a.number);var i,c,l,q=e=g=d=0,n=0,o=0;i=a.get("scale_width");c=i/2;l=a.get("scaleAlign");var m=a.get("textAlign"),k=a.get("text_space"),p="";a.push("which",a.get("which").toLowerCase());a.isH="h"==a.get("which");a.isH?("top"==l?q=-i:"center"==l?(q=-c,g=c):g=i,"top"==m?(o=-k,p="bottom"):(o=k,p="top"),m="center"):("left"==l?e=-i:"center"==l?(e=-c,d=c):d=i,p="middle","right"==m)?(m="left",n=k):(m="right",n=-k);for(k=0;k<=a.number;k++)i=b?a.get("labels")[k]:(f*k+h).toFixed(a.get("decimalsnum")),c=a.isH?a.get("valid_x")+k*a.get("distanceOne"):a.x,l=a.isH?a.y:a.get("valid_y")+a.get("distance")-k*a.get("distanceOne"),a.items.push({x:c,y:l,x0:c+e,y0:l+q,x1:c+d,y1:l+g}),a.labels.push(new iChart.Text(iChart.applyIf(iChart.apply(a.get("label"),iChart.merge({text:i,x:c,y:l,originx:c+n,originy:l+o},a.fireEvent(a,"parseText",[i,c+n,l+o,k,a.number==k]))),{textAlign:m,textBaseline:p}),a))}});iChart.Coordinate={coordinate_:function(){var a=this._();return a.is3D()?(a.push("coordinate.xAngle_",a.get("xAngle_")),a.push("coordinate.yAngle_",a.get("yAngle_")),a.push("coordinate.zHeight",a.get("zHeight")*a.get("bottom_scale")),new iChart.Coordinate3D(iChart.apply({scale:{position:a.get("scaleAlign"),scaleAlign:a.get("scaleAlign"),max_scale:a.get("maxValue"),min_scale:a.get("minValue")}},a.get("coordinate")),a)):new iChart.Coordinate2D(iChart.apply({scale:{position:a.get("scaleAlign"),max_scale:a.get("maxValue"),min_scale:a.get("minValue")}},a.get("coordinate")),a)},coordinate:function(){var a=this._(),b=a.get("client_width"),d=a.get("client_height"),g=a.pushIf("coordinate.width",Math.floor(0.9*b)),f=a.pushIf("coordinate.height",Math.floor(0.9*d));f>d&&(f=a.push("coordinate.height",0.9*d));g>b&&(g=a.push("coordinate.width",0.9*b));a.is3D()&&(f=a.push("coordinate.height",f-(a.get("coordinate.pedestal_height")||22)-(a.get("coordinate.board_deep")||20)));"left"==a.get("align")?a.push("originx",a.get("l_originx")):"right"==a.get("align")?a.push("originx",a.get("r_originx")-g):a.push("originx",a.get("centerx")-g/2);a.push("originx",a.get("originx")+a.get("offsetx"));a.push("originy",a.get("centery")-f/2+a.get("offsety"));(!a.get("coordinate.valid_width")||a.get("coordinate.valid_width")>g)&&a.push("coordinate.valid_width",g);(!a.get("coordinate.valid_height")||a.get("coordinate.valid_height")>f)&&a.push("coordinate.valid_height",f);a.x=a.get("originx");a.y=a.get("originy");a.push("coordinate.originx",a.x);a.push("coordinate.originy",a.y)}};iChart.Coordinate2D=iChart.extend(iChart.Component,{configure:function(){iChart.Coordinate2D.superclass.configure.apply(this,arguments);this.type="coordinate2d";this.set({sign_size:12,sign_space:5,scale:[],valid_width:void 0,valid_height:void 0,grid_line_width:1,grid_color:"#dbe1e1",gridlinesVisible:!0,scale2grid:!0,grids:void 0,ignoreOverlap:!0,ignoreEdge:!1,xlabel:"",ylabel:"",alternate_color:!0,alternate_direction:"v",alternate_color_factor:0.01,crosshair:{enable:!1},width:void 0,height:void 0,z_index:-1,axis:{enable:!0,color:"#666666",width:1}});this.registerEvent();this.scale=[];this.gridlines=[]},getScale:function(a){for(var b=0;b<this.scale.length;b++){var d=this.scale[b];if(d.get("position")==a)return{start:d.get("start_scale"),end:d.get("end_scale"),distance:d.get("end_scale")-d.get("start_scale")}}return{start:0,end:0,distance:0}},isEventValid:function(a){return{valid:a.x>this.x&&a.x<this.x+this.get("width")&&a.y<this.y+this.get("height")&&a.y>this.y}},doDraw:function(){var a=this._();a.T.box(a.x,a.y,a.get("width"),a.get("height"),0,a.get("f_color"));if(a.get("alternate_color")){var b,d,g=!1,f=[0,0,0,0],e=iChart.dark(a.get("background_color"),a.get("alternate_color_factor"));a.get("axis.enable")&&(f=a.get("axis.width"))}var h=a.get("grid_line_width"),i="v"==a.get("alternate_direction");a.gridlines.each(function(c){c.x1=Math.round(c.x1);c.y1=Math.round(c.y1);c.x2=Math.round(c.x2);c.y2=Math.round(c.y2);a.get("alternate_color")&&(g&&(i?a.T.box(c.x1+f[3],c.y1+h,c.x2-c.x1-f[3]-f[1],d-c.y1-h,0,e):a.T.box(b+h,c.y2+f[0],c.x1-b,c.y1-c.y2-f[0]-f[2],0,e)),b=c.x1,d=c.y1,g=!g);a.T.line(c.x1,c.y1,c.x2,c.y2,h,a.get("grid_color"))});a.T.box(a.x,a.y,a.get("width"),a.get("height"),a.get("axis"),!1,a.get("shadow"));a.scale.each(function(a){a.draw()})},doConfig:function(){iChart.Coordinate2D.superclass.doConfig.call(this);var a=this._();iChart.Assert.isNumber(a.get("width"),"width");iChart.Assert.isNumber(a.get("height"),"height");a.atomic=!1;a.get("gradient")&&iChart.isString(a.get("f_color"))&&a.push("f_color",a.T.avgLinearGradient(a.x,a.y,a.x,a.y+a.get("height"),[a.get("dark_color"),a.get("light_color")]));if(a.get("axis.enable")){var b=a.get("axis.width");iChart.isArray(b)||a.push("axis.width",[b,b,b,b])}a.get("crosshair.enable")&&(a.push("crosshair.wrap",a.container.shell),a.push("crosshair.height",a.get("height")),a.push("crosshair.width",a.get("width")),a.push("crosshair.top",a.y),a.push("crosshair.left",a.x),a.crosshair=new iChart.CrossHair(a.get("crosshair"),a));var d,g=(b=!(!a.get("gridlinesVisible")||!a.get("grids")))&&!!a.get("grids.horizontal"),f=b&&!!a.get("grids.vertical"),e=a.get("height"),h=a.get("width"),i=a.get("valid_width"),c=a.get("valid_height"),b=a.get("gridlinesVisible")&&a.get("scale2grid")&&!(g&&f),l=(h-i)/2,q=(e-c)/2,n=a.get("axis.width");iChart.isArray(a.get("scale"))||(iChart.isObject(a.get("scale"))?a.push("scale",[a.get("scale")]):a.push("scale",[]));a.get("scale").each(function(b){d=(d=b.position)||"left";d=d.toLowerCase();b.originx=a.x;b.originy=a.y;b.valid_x=a.x+l;b.valid_y=a.y+q;b.position=d;if(d=="top"){b.which="h";b.distance=h;b.valid_distance=i}else if(d=="right"){b.which="v";b.distance=e;b.valid_distance=c;b.originx=b.originx+h;b.valid_x=b.valid_x+i}else if(d=="bottom"){b.which="h";b.distance=h;b.valid_distance=i;b.originy=b.originy+e;b.valid_y=b.valid_y+c}else{b.which="v";b.distance=e;b.valid_distance=c}a.scale.push(new iChart.Scale(b,a.container))},a);var o=a.push("ignoreOverlap",a.get("ignoreOverlap")&&a.get("axis.enable")||a.get("ignoreEdge"));if(o)var m=a.get("ignoreEdge")?function(b,c,d){return b=="v"?d==a.y||d==a.y+e:c==a.x||c==a.x+b}:function(b,c,d){return b=="v"?d==a.y&&n[0]>0||d==a.y+e&&n[2]>0:c==a.x&&n[3]>0||c==a.x+h&&n[1]>0};if(b){var k,p,s;a.scale.each(function(b){s=b.get("position");if(!iChart.isFalse(b.get("scale2grid"))&&!(g&&b.get("which")=="v"||f&&b.get("which")=="h")){k=p=0;s=="top"?p=e:s=="right"?k=-h:s=="bottom"?p=-e:k=h;b.items.each(function(c){(!o||!m.call(a,b.get("which"),c.x,c.y))&&a.gridlines.push({x1:c.x,y1:c.y,x2:c.x+k,y2:c.y+p})})}})}if(f){var j=a.get("grids.vertical");iChart.Assert.gtZero(j.value,"value");var b=h/j.value,r=j.value;"given_value"==j.way&&(r=b,b=j.value,b=b>h?h:b);for(j=0;j<=r;j++)(!o||!m.call(a,"h",a.x+j*b,a.y))&&a.gridlines.push({x1:a.x+j*b,y1:a.y,x2:a.x+j*b,y2:a.y+e})}if(g){j=a.get("grids.horizontal");iChart.Assert.gtZero(j.value,"value");b=e/j.value;r=j.value;"given_value"==j.way&&(r=b,b=j.value,b=b>e?e:b);for(j=0;j<=r;j++)(!o||!m.call(a,"v",a.x,a.y+j*b))&&a.gridlines.push({x1:a.x,y1:a.y+j*b,x2:a.x+h,y2:a.y+j*b})}}});iChart.Coordinate3D=iChart.extend(iChart.Coordinate2D,{configure:function(){iChart.Coordinate3D.superclass.configure.apply(this,arguments);this.type="coordinate3d";this.dimension=iChart._3D;this.set({xAngle:60,yAngle:20,xAngle_:void 0,yAngle_:void 0,zHeight:0,pedestal_height:22,board_deep:20,gradient:!0,color_factor:0.18,ignoreEdge:!0,alternate_color:!1,grid_color:"#7a8d44",background_color:"#d6dbd2",shadow_offsetx:4,shadow_offsety:2,wall_style:[],axis:{enable:!1}})},doDraw:function(){var a=this._(),b=a.get("width"),d=a.get("height"),g=a.get("xAngle_"),f=a.get("yAngle_"),e=a.get("zHeight"),h=g*e,i=f*e;a.T.cube3D(a.x,a.y+d+a.get("pedestal_height"),g,f,!1,b,a.get("pedestal_height"),3*e/2,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("bottom_style"));a.T.cube3D(a.x+a.get("board_deep")*g,a.y+d-a.get("board_deep")*f,g,f,!1,b,d,e,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("board_style"));a.T.cube3D(a.x,a.y+d,g,f,!1,b,d,e,a.get("axis.enable"),a.get("axis.width"),a.get("axis.color"),a.get("wall_style"));a.gridlines.each(function(b){a.T.line(b.x1,b.y1,b.x1+h,b.y1-i,a.get("grid_line_width"),a.get("grid_color"));a.T.line(b.x1+h,b.y1-i,b.x2+h,b.y2-i,a.get("grid_line_width"),a.get("grid_color"))});a.scale.each(function(a){a.draw()})},doConfig:function(){iChart.Coordinate3D.superclass.doConfig.call(this);var a=this._(),b=a.get("wall_style"),d=a.get("background_color"),g=iChart.dark(d,0.1),f=a.get("dark_color"),e=a.get("height"),h=a.get("width");3>b.length&&(b=a.push("wall_style",[{color:g},{color:d},{color:g}]));var i=b[0].color;a.push("bottom_style",[{shadow:a.get("shadow")},!1,!1,{color:i},{color:i},{color:i}]);a.push("board_style",[!1,!1,!1,{color:i},{color:d},!1]);if(a.get("gradient")){var c=a.get("xAngle_")*a.get("zHeight"),l=a.get("yAngle_")*a.get("zHeight"),q=a.get("bottom_style");iChart.isString(b[0].color)&&(b[0].color=a.T.avgLinearGradient(a.x,a.y+e,a.x+h,a.y+e,[i,f]));iChart.isString(b[1].color)&&(b[1].color=a.T.avgLinearGradient(a.x+c,a.y-l,a.x+c,a.y+e-l,[f,a.get("light_color")]));iChart.isString(b[2].color)&&(b[2].color=a.T.avgLinearGradient(a.x,a.y,a.x,a.y+e,[d,f]));q[5].color=a.T.avgLinearGradient(a.x,a.y+e,a.x,a.y+e+a.get("pedestal_height"),[d,g])}}});