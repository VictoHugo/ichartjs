iChart.LineSegment=iChart.extend(iChart.Component,{configure:function(){iChart.LineSegment.superclass.configure.apply(this,arguments);this.type="linesegment";this.set({intersection:!0,label:!1,point_style:"round",point_hollow:!0,smooth:!1,smoothing:1.5,point_size:3,points:[],keep_with_coordinate:!1,shadow_blur:1,shadow_offsety:1,point_space:0,coordinate:null,event_range_x:0,limit_y:!1,tip_offset:2,event_range_y:0});this.tip=this.label=null;this.ignored_=!1},drawSegment:function(){this.T.shadowOn(this.get("shadow"));var a=this.get("points");if(this.get("area")){for(var e=[this.x,this.y],c=0;c<a.length;c++)e.push(a[c].x),e.push(a[c].y);e.push(this.x+this.get("width"));e.push(this.y);c=this.get("light_color");this.get("gradient")&&(c=this.T.avgLinearGradient(this.x,this.y-this.get("height"),this.x,this.y,[this.get("light_color2"),c]));this.T.polygon(c,!1,1,"",!1,"",0,0,0,this.get("area_opacity"),e)}this.T[this.ignored_?"manyLine":"lineArray"](a,this.get("brushsize"),this.get("f_color"),this.get("smooth"),this.get("smoothing"));this.get("intersection")&&a.each(function(a){a.ignored||(this.get("point_hollow")?this.T.round(a.x,a.y,this.get("point_size"),"#FEFEFE",this.get("brushsize"),this.get("f_color")):this.T.round(a.x,a.y,this.get("point_size"),this.get("f_color")))},this);this.get("shadow")&&this.T.shadowOff()},doDraw:function(){this.drawSegment();this.get("intersection")&&this.get("label")&&this.get("points").each(function(a){a.ignored||this.T.text(a.value,a.x,a.y-3*this.get("point_size")/2,!1,this.get("f_color"),"center","bottom",this.get("fontStyle"))},this)},isEventValid:function(){return{valid:!1}},tipInvoke:function(){var a=this.x,e=this.get("tip_offset"),c=this.get("point_size")+e,f=this;return function(g,d,b){var h=b.left,i=b.top,h=3>f.tipPosition&&0<b.left-g-a-e||2<f.tipPosition&&0>b.left-g-a-e?h-(g+e):h+e,i=0==f.tipPosition%2?b.top+c:b.top-d-c;return{left:h,top:i}}},doConfig:function(){iChart.LineSegment.superclass.doConfig.call(this);iChart.Assert.gtZero(this.get("point_space"),"point_space");for(var a=this,e=this.get("point_space"),c=a.get("event_range_y"),f=a.get("event_range_x"),g=a.get("tipInvokeHeap"),d=a.get("points"),b=0;b<d.length;b++)d[b].x_=d[b].x,d[b].y_=d[b].y,d[b].ignored&&(this.ignored_=!0);f=0==f?a.push("event_range_x",Math.floor(e/2)):a.push("event_range_x",iChart.between(1,Math.floor(e/2),f));0==c&&(c=a.push("event_range_y",Math.floor(a.get("point_size"))));a.get("tip.enable")&&(a.on("mouseover",function(){g.push(a);a.tipPosition=g.length}).on("mouseout",function(){g.pop()}),a.push("tip.invokeOffsetDynamic",!0),a.tip=new iChart.Tip(a.get("tip"),a));var h=a.get("coordinate"),i=a.get("limit_y"),j=a.get("keep_with_coordinate"),k=function(a,d,e){return!a.ignored&&Math.abs(d-a.x)<f&&(!i||i&&Math.abs(e-a.y)<c)?true:false},l=function(a){return{valid:true,text:d[a].text,value:d[a].value,top:d[a].y,left:d[a].x,i:a,hit:true}};a.isEventValid=function(c){if(h&&!h.isEventValid(c).valid)return{valid:false};var b=Math.floor((c.x-a.x)/e);if(b<0||b>=d.length-1){b=iChart.between(0,d.length-1,b);return k(d[b],c.x,c.y)?l(b):{valid:j}}for(var f=b;f<=b+1;f++)if(k(d[f],c.x,c.y))return l(f);return{valid:j}}}});