iChart.LineSegment=iChart.extend(iChart.Component,{configure:function(){iChart.LineSegment.superclass.configure.apply(this,arguments);this.type="linesegment";this.set({intersection:!0,label:{},sign:"round",hollow:!0,hollow_color:"#FEFEFE",smooth:!1,smoothing:1.5,point_size:6,points:[],keep_with_coordinate:!1,shadow_blur:1,shadow_offsety:1,point_space:0,coordinate:null,event_range_x:0,limit_y:!1,tip_offset:2,event_range_y:0});this.registerEvent("parseText");this.tip=null;this.ignored_=!1},drawSegment:function(){var a=this._(),f=a.get("points"),g=a.get("f_color"),h=a.get("brushsize");a.T.shadowOn(a.get("shadow"));if(a.get("area")){var e=[a.x,a.y];f.each(function(a){e.push(a.x);e.push(a.y)});e.push(a.x+a.get("width"));e.push(a.y);a.T.polygon(a.get("light_color2"),!1,1,"",!1,a.get("area_opacity"),e)}a.T[a.ignored_?"manyLine":"lineArray"](f,h,g,a.get("smooth"),a.get("smoothing"));if(a.get("intersection")){var i=a.getPlugin("sign"),b=a.get("point_size");a.get("hollow_color");f.each(function(c){if(!c.ignored&&(!i||!i.call(a,a.T,a.get("sign"),c.x,c.y,b,g)))a.get("hollow")?a.T.round(c.x,c.y,3*b/8,a.get("hollow_color"),b/4,g):a.T.round(c.x,c.y,b/2,g)},a)}a.get("shadow")&&a.T.shadowOff()},doDraw:function(){this.drawSegment();this.get("label")&&this.labels.each(function(a){a.draw()})},isEventValid:function(){return{valid:!1}},tipInvoke:function(){var a=this.x,f=this.get("tip_offset"),g=this.get("point_size")+f,h=this;return function(e,i,b){var c=b.left,j=b.top,c=3>h.tipPosition&&0<b.left-e-a-f||2<h.tipPosition&&0>b.left-e-a-f?c-(e+f):c+f,j=0==h.tipPosition%2?b.top+g:b.top-i-g;return{left:c,top:j}}},doConfig:function(){iChart.LineSegment.superclass.doConfig.call(this);iChart.Assert.gtZero(this.get("point_space"),"point_space");var a=this._(),f=!!a.get("label"),g=3*a.get("point_size")/2,h=a.get("point_space"),e=a.get("event_range_y"),i=a.get("event_range_x"),b=a.get("tipInvokeHeap"),c=a.get("points");a.labels=[];c.each(function(d){d.x_=d.x;d.y_=d.y;d.value=a.fireString(a,"parseText",[a,d.value],d.value);d.ignored&&(a.ignored_=!0);!d.ignored&&f&&(a.push("label.originx",d.x),a.push("label.originy",d.y-g),a.push("label.text",d.value),iChart.applyIf(a.get("label"),{textBaseline:"bottom",color:a.get("f_color")}),a.labels.push(new iChart.Text(a.get("label"),a)))});i=0==i?a.push("event_range_x",Math.floor(h/2)):a.push("event_range_x",iChart.between(1,Math.floor(h/2),i));0==e&&(e=a.push("event_range_y",Math.floor(a.get("point_size")/2)));a.get("tip.enable")&&(a.on("mouseover",function(){b.push(a);a.tipPosition=b.length}).on("mouseout",function(){b.pop()}),a.push("tip.invokeOffsetDynamic",!0),a.tip=new iChart.Tip(a.get("tip"),a));var j=a.get("coordinate"),k=a.get("limit_y"),l=a.get("keep_with_coordinate"),m=function(a,c,b){return!a.ignored&&Math.abs(c-a.x)<i&&(!k||k&&Math.abs(b-a.y)<e)?true:false},n=function(a){return{valid:true,text:c[a].text,value:c[a].value,top:c[a].y,left:c[a].x,i:a,hit:true}};a.isEventValid=function(d){if(j&&!j.isEventValid(d).valid)return{valid:false};var b=Math.floor((d.x-a.x)/h);if(b<0||b>=c.length-1){b=iChart.between(0,c.length-1,b);return m(c[b],d.x,d.y)?n(b):{valid:l}}for(var e=b;e<=b+1;e++)if(m(c[e],d.x,d.y))return n(e);return{valid:l}}}});