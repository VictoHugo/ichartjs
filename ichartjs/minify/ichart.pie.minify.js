iChart.Pie=iChart.extend(iChart.Chart,{configure:function(){iChart.Pie.superclass.configure.call(this);this.type="pie";this.set({radius:"100%",offset_angle:0,separate_angle:0,bound_event:"click",counterclockwise:!1,intellectLayout:!0,layout_distance:4,pop_animate:!1,mutex:!1,increment:void 0,sub_option:{label:{}}});this.registerEvent("bound","rebound");this.sectors=[];this.components.push(this.sectors);this.ILLUSIVE_COO=!0},toggle:function(a){this.sectors[a||0].toggle()},bound:function(a){this.sectors[a||0].bound()},rebound:function(a){this.sectors[a||0].rebound()},getSectors:function(){return this.sectors},doAnimation:function(a,f,b){var d=0,g=b.oA;b.sectors.each(function(e){d=b.animationArithmetic(a,0,e.get("totalAngle"),f);e.push("startAngle",g);e.push("endAngle",g+d);g+=d;b.is3D()||e.drawSector()});b.is3D()&&b.proxy.drawSector()},parse:function(a){a.data.each(function(f,b){a.doParse(a,f,b)},a);a.localizer(a)},doParse:function(a,f,b){var d=f.name+" "+a.getPercent(f.value);a.doActing(a,f,null,b,d);a.push("sub_option.id",b);a.get("sub_option.label")&&a.push("sub_option.label.text",d);a.push("sub_option.listeners.changed",function(b,e){a.fireEvent(a,e?"bound":"rebound",[a,b.get("name")])});a.sectors.push(a.doSector(a,f))},doSector:function(a){return new iChart[a.sub](a.get("sub_option"),a)},dolayout:function(a,f,b,d,g,e){if(a.is3D()?iChart.inEllipse(a.get(a.X)-f,a.topY-b,a.a,a.b):iChart.distanceP2P(a.get(a.X),a.topY,f,b)<a.r)b=a.topY-b,d.push("labelx",a.get(a.X)+(2*Math.sqrt(a.r*a.r-b*b)+g)*(0==e||3==e?1:-1)),d.localizer(d)},localizer:function(a){if(a.get("intellectLayout")){var f=[],b=[],d=a.get("layout_distance"),g,e,h;a.sectors.each(function(a){a.isLabel()&&f.push(a.label)});f.sor(function(a,b){return 0<Math.abs(Math.sin(a.get("angle")))-Math.abs(Math.sin(b.get("angle")))});f.each(function(c){"Opera"==c.get("text")&&console.log(c.get("text")+","+Math.sin(c.get("angle")));b.each(function(b){e=b.labelx;h=b.labely;if(c.labely<=h&&h-c.labely-1<c.get(a.H)||c.labely>h&&c.labely-h-1<b.get(a.H))if(c.labelx<=e&&e-c.labelx<c.get(a.W)||c.labelx>e&&c.labelx-e<b.get(a.W))g=c.get("quadrantd"),c.push("labely",c.get("labely")+h-c.labely+(c.get(a.H)+d)*(1<g?-1:1)),c.localizer(c),a.dolayout(a,c.get("labelx"),c.get("labely")+c.get(a.H)/2*(2>g?-1:1),c,d,g)},a);b.push(c)})}},doConfig:function(){iChart.Pie.superclass.doConfig.call(this);var a=this._(),f,b=a.get("radius"),d=a.get("sub_option.label")?0.35:0.44,g=2*Math.PI;a.sub=a.is3D()?"Sector3D":"Sector2D";a.sectors.zIndex=a.get("z_index");a.sectors.length=0;a.oA=iChart.angle2Radian(a.get("offset_angle"))%g;a.is3D()&&(d+=0.06);var e=a.data.length,h=iChart.angle2Radian(iChart.between(0,90,a.get("separate_angle"))),c=g-h,h=h/e,i=a.oA+h,j=i;0==a.total&&(f=1/e);a.data.each(function(b,d){i+=(f||b.value/a.total)*c;d==e-1&&(i=g+a.oA);b.startAngle=j;b.endAngle=i;b.totalAngle=i-j;b.middleAngle=(j+i)/2;j=i+h},a);a.r=b=iChart.parsePercent(b,Math.floor(a.get("minDistance")*d));a.topY=a.originXY(a,[b+a.get("l_originx"),a.get("r_originx")-b,a.get("centerx")],[a.get("centery")]).y;iChart.apply(a.get("sub_option"),iChart.clone([a.X,a.Y,"bound_event","mutex","increment"],a.options))}});