iChart.Gauge2D=iChart.extend(iChart.Chart,{configure:function(){iChart.Gauge2D.superclass.configure.call(this);this.type="gauge2d";this.dataType="single";this.set({radius:"100%",value:null,panel:{background_color:"#FEFEFE",gradient:!0,gradient_mode:"RadialGradientOutIn",border:{color:"#dedede",width:0},iborder:{radius:"95%",color:"#d8d8da",width:10}},tickmarks:{start_angle:30,end_angle:null,space_angle:4,radius:"88%",width:10,bg_color:"#4fa9db",size:2,count:5,color:"#344352",lower:0,upper:100,small_color:"#344352",small_count:5,ranges:[]},label:{fontsize:11,label_space:12},text:{text:"",line_height:24,fontweight:"bold",fontsize:18},screen:{decimalsnum:1,unit_pre:"",unit_post:"",background_color:"#fefefe",height:22,width:60,fontsize:13,fontweight:600,border:{enable:!0}},needle:{radius:"94%",size:4,color:"red",alpham:0.9,border:{enable:!0,width:1,color:"#bcbcbc"}},cap:{size:10,color:"#7bbfec",border:{enable:!0,width:1,color:"#bcbcbc"}},animation:!0,animation_duration:500,animation_timing_function:"easeOut"});this.push("data",[0])},doAnimation:function(b,d,c){b=c.animationArithmetic(b,c.needle.start,c.needle.offset,d);c.panel.draw();c.tickmark.draw();c.screen.push("text",b);c.screen.draw();c.text&&c.text.draw();c.needle.push("value",b);c.needle.draw()},to:function(b){var d=this._();b!=d.needle.value&&(d.needle.start=d.processAnimation?d.needle.get("value"):d.needle.value,d.needle.value=parseFloat(b),d.needle.offset=d.needle.value-d.needle.start,d.runAnimation(d))},doConfig:function(){iChart.Gauge2D.superclass.doConfig.call(this);var b=this._(),d=2*Math.PI,c=Math.floor(0.5*b.get("minDistance")),f=iChart.parsePercent(b.get("radius"),c);b.push("tip",!1);b.push("legend",!1);b.originXY(b,[f+b.get("l_originx"),b.get("r_originx")-f,b.get("centerx")],[b.get("centery")]);b.panel=new iChart.Custom(iChart.apply(b.get("panel"),{z_index:b.get("z_index")-10,radius:f,shadow:b.get("shadow"),originx:b.x,originy:b.y,configFn:function(a){a.r=a.get("radius");a.applyGradient(a.x-a.r,a.y-a.r,1.8*a.r,1.8*a.r);a.ir=iChart.parsePercent(a.get("iborder.radius"),a.r);a.iborder=0<a.get("iborder.width")},drawFn:function(a){a.T.sector(a.x,a.y,a.r,0,0,d,a.get("f_color"),a.get("border.width"),a.get("border.width"),a.get("border.color"),a.get("shadow"),!1,!0);a.iborder&&a.T.sector(a.x,a.y,a.ir,0,0,d,0,!0,a.get("iborder.width"),a.get("iborder.color"),a.get("iborder.shadow"),!1,!0,!0)}}),b);b.tickmark=new iChart.Custom(iChart.apply(b.get("tickmarks"),{z_index:b.get("z_index")-9,originx:b.x,originy:b.y,label:b.get("label"),configFn:function(a){a.r=iChart.parsePercent(a.get("radius"),f);a.tickbg=[];a.tickmarks=[];a.labels=[];a.pushIf("end_angle",-a.get("start_angle"));var b=a.push("count",iChart.lowTo(2,a.get("count"))),d=a.push("space_angle",iChart.angle2Radian(a.get("space_angle"))),c=a.push("start_angle",iChart.angle2Radian(a.get("start_angle")+90))+d,g=a.push("end_angle",iChart.angle2Radian(a.get("end_angle")+450))-d,p=[].concat(a.get("bg_color")),k=[].concat(a.get("color")),l=[].concat(a.get("small_color")),n=a.get("small_count")||1,h=a.get("lower"),e=a.get("upper"),q=(e-h)/b,i=g-c,o=i/b,t=o/n,j=a.get("size"),m=a.get("width")-1,r=a.r-m-a.get("label.label_space"),j=j/2/a.r,s=0.6*j;a.minMarks=q/n;a.lower=h;a.upper=e;a.sA=c;a.eA=g;a.tA=i;for(e=0;e<=b;e++){k[e]=k[e]||k[e-1];l[e]=l[e]||l[e-1];a.tickmarks.push({start:c-j,end:c+j,radius:a.r-1,width:m,color:k[e]});e<b&&p[e]&&a.tickbg.push({start:c-(0==e?d:0),end:c+o+(1==b-e?d:0),color:p[e]});g=c;for(i=0;e<b&&i<n-1;i++)g+=t,a.tickmarks.push({start:g-s,end:g+s,radius:a.r-1-0.4*m,width:0.6*m,color:l[e]});a.labels.push(new iChart.Text(iChart.apply(a.get("label"),{text:h,textAlign:"center",textBaseline:"middle",originx:a.x+Math.cos(c)*r,originy:a.y+Math.sin(c)*r}),a));h+=q;c+=o}},drawFn:function(a){a.tickbg.each(function(b){a.T.sector(a.x,a.y,a.r,a.get("width"),b.start,b.end,b.color,0,0,0,0,!1,!0,!0)});a.tickmarks.each(function(b){a.T.sector(a.x,a.y,b.radius,b.width,b.start,b.end,b.color,0,0,0,0,!1,!0,!0)});a.labels.each(function(a){a.draw()})}}),b);c=!b.get("value")&&0!=b.get("value")?b.tickmark.lower:b.get("value");b.screen=new iChart.Text(iChart.apply(b.get("screen"),{z_index:b.get("z_index")-8,originx:b.x-b.get("screen.width")/2,originy:b.y+f/3,text:c}),b);b.screen.on("beforedraw",function(){this.push("text",this.get("unit_pre")+parseFloat(this.get("text")).toFixed(this.get("decimalsnum"))+this.get("unit_post"));return!0});$.isString(b.get("text"))&&b.push("text",$.applyIf({text:b.get("text")},b.default_.text));""!=b.get("text.text")&&(b.text=new $.Text(iChart.apply(b.get("text"),{z_index:b.get("z_index")-8,originx:b.x,originy:b.y-f/3,textBaseline:"middle"}),b),b.components.push(b.text));b.needle=new iChart.Custom({z_index:b.get("z_index")-6,needle:b.get("needle"),cap:b.get("cap"),radius:iChart.parsePercent(b.get("needle.radius"),b.tickmark.r-0.5*b.get("tickmarks.width")),originx:b.x,originy:b.y,tickmark:b.tickmark,value:c,getRadian:function(a){var c=b.tickmark.lower,d=b.tickmark.upper,a=c>d?iChart.between(d,c,a):iChart.between(c,d,a);return Math.abs((a-c)/(d-c)*b.tickmark.tA)+b.tickmark.sA},configFn:function(a){a.tickmark=a.get("tickmark");a.r=iChart.parsePercent(a.get("needle.radius"),a.tickmark.r-a.tickmark.get("width")*0.5);a.getRadian=a.get("getRadian");a.value=a.get("value");a.start=a.tickmark.lower;a.offset=a.value-a.start},drawFn:function(a){var b=a.getRadian(a.get("value")),c=a.get("cap.size"),f=a.get("needle.size")/c;a.T.polygon(a.get("needle.color"),a.get("needle.border.enable"),a.get("needle.border.width"),a.get("needle.border.color"),a.get("needle.shadow"),a.get("needle.alpham")||1,[{x:a.x+Math.cos(b-f)*c,y:a.y+Math.sin(b-f)*c},{x:a.x+Math.cos(b+f)*c,y:a.y+Math.sin(b+f)*c},{x:a.x+Math.cos(b)*a.r,y:a.y+Math.sin(b)*a.r}]);a.T.sector(a.x,a.y,c,0,0,d,a.get("cap.color"),a.get("cap.border.enable"),a.get("cap.border.width"),a.get("cap.border.color"),a.get("needle.shadow"),false,true)}},b);b.components.push(b.screen);b.components.push(b.panel);b.components.push(b.tickmark);b.components.push(b.needle)}});