(function(i){function w(a){"string"===typeof a&&(a=document.getElementById(a));if(!a||!a.tagName||"canvas"!=a.tagName.toLowerCase())throw Error("there not a canvas element");this.canvas=a;this.c=this.canvas.getContext("2d");this.width=this.canvas.width;this.height=this.canvas.height}var v=Math.PI/90,m=Math.PI,x=2*Math.PI,s=Math.sin,t=Math.cos,q=function(a,b){return 1>=a?Math.floor(b)+0.5:Math.floor(b)};w.prototype={css:function(a,b){if(i.isDefined(b))this.canvas.style[a]=b;else return this.canvas.style[a]},arc:function(a,b,c,d,g,f,e,h,l,k,i,j,n,u,p,r,m){p=!!p;r=!!r;this.c.save();m&&(this.c.globalCompositeOperation="destination-over");e&&this.strokeStyle(h,l);this.shadowOn(k,i,j,n,u).fillStyle(f);this.c.moveTo(a,b);this.c.beginPath();this.c.arc(a,b,c,d,g,p);r&&this.c.lineTo(a,b);this.c.closePath();this.c.fill();e&&this.c.stroke();this.c.restore();return this},ellipse:function(a,b,c,d,g,f,e,h,l,k,i,j,n,u,p,r,m,q){r=!!r;m=!!m;this.c.save();q&&(this.c.globalCompositeOperation="destination-over");d&&this.strokeStyle(l,k);this.shadowOn(i,j,n,u,p).fillStyle(e);this.c.moveTo(a,b);this.c.beginPath();for(m&&this.c.moveTo(a,b);g<=f;)this.c.lineTo(a+c*t(g),b+(r?-d*s(g):d*s(g))),g+=v;this.c.lineTo(a+c*t(f),b+(r?-d*s(f):d*s(f)));this.c.closePath();d&&this.c.stroke();this.c.fill();this.c.restore();return this},sector:function(a,b,c,d,g,f,e,h,l,k,i,j,n,u,p){k?(this.arc(a,b,c,d,g,f,e,h,l,k,i,j,n,u,p,!0),this.arc(a,b,c,d,g,f,e,h,l,!1,i,j,n,u,p,!0)):this.arc(a,b,c,d,g,f,e,h,l,!1,0,0,0,0,p,!0);return this},sector3D:function(){var a=function(a,b,g,f,e,h,l,k,o){if(l&&h<=m||!l&&e>=m)return!1;var j=function(e,h){this.c.lineTo(a+g*t(e),b+(h||0)+(l?-f*s(e):f*s(e)))},e=l&&h>m&&e<m?m:e,h=!l&&e<m&&h>m?m:h,n=e;this.c.fillStyle=i.dark(o);this.c.moveTo(a+g*t(e),b+(l?-f*s(e):f*s(e)));for(this.c.beginPath();n<=h;)j.call(this,n),n+=v;j.call(this,h);this.c.lineTo(a+g*t(h),b+k+(l?-f*s(h):f*s(h)));for(n=h;n>=e;)j.call(this,n,k),n-=v;j.call(this,e,k);this.c.lineTo(a+g*t(e),b+(l?-f*s(e):f*s(e)));this.c.closePath();this.c.fill()},b=function(a,b,g,f,e,h,l,k){this.c.moveTo(a,b);this.c.beginPath();this.c.fillStyle=i.dark(k);this.c.lineTo(a,b+h);g=a+g*t(l);f=b+h+(e?-f*s(l):f*s(l));this.c.lineTo(g,f);this.c.lineTo(g,f-h);this.c.lineTo(a,b);this.c.closePath();this.c.fill()};return function(c,d,g,f,e,h,l,k,o,j,n,u,p,r,q,s,t){u=u&&!i.isOpera;this.c.save();this.c.globalCompositeOperation="destination-over";this.c.fillStyle=k;var v=t?e<m/2||e>1.5*m:e>m/2&&e<1.5*m,w=t?h>m/2&&h<1.5*m:h<m/2||h>1.5*m;if(v||w)v&&b.call(this,c,d,g,f,t,l,e,k),w&&b.call(this,c,d,g,f,t,l,h,k);this.ellipse(c,d+l,g,f,e,h,k,o,j,n,u,p,r,q,s,t,!0);this.c.globalCompositeOperation="source-over";this.ellipse(c,d,g,f,e,h,k,o,j,n,!1,p,r,q,s,t,!0);a.call(this,c,d,g,f,e,h,t,l,k);this.c.restore();return this}}(),textStyle:function(a,b,c){return this.textAlign(a).textBaseline(b).textFont(c)},strokeStyle:function(a,b,c){a&&(this.c.lineWidth=a);b&&(this.c.strokeStyle=b);c&&(this.c.lineJoin=c);return this},globalAlpha:function(a){a&&(this.c.globalAlpha=a);return this},fillStyle:function(a){a&&(this.c.fillStyle=a);return this},textAlign:function(a){a&&(this.c.textAlign=a);return this},textBaseline:function(a){a&&(this.c.textBaseline=a);return this},textFont:function(a){a&&(this.c.font=a);return this},shadowOn:function(a,b,c,d,g){i.isString(a)&&(g=d,d=c,c=b,b=!0);a&&(this.c.shadowColor=b,this.c.shadowBlur=c,this.c.shadowOffsetX=d,this.c.shadowOffsetY=g);return this},shadowOff:function(){this.c.shadowColor="white";this.c.shadowBlur=this.c.shadowOffsetX=this.c.shadowOffsetY=0},avgLinearGradient:function(a,b,c,d,g){a=this.createLinearGradient(a,b,c,d);for(b=0;b<g.length;b++)a.addColorStop(b/(g.length-1),g[b]);return a},createLinearGradient:function(a,b,c,d){return this.c.createLinearGradient(a,b,c,d)},avgRadialGradient:function(a,b,c,d,g,f,e){a=this.createRadialGradient(a,b,c,d,g,f);for(b=0;b<e.length;b++)a.addColorStop(b/(e.length-1),e[b]);return a},createRadialGradient:function(a,b,c,d,g,f){return this.c.createRadialGradient(a,b,c,d,g,f)},fillText:function(a,b,c,d,g,f,e){a+="";d=d||!1;f=f||"lr";e=e||16;this.fillStyle(g);a.split("tb"==f?"":"\n").each(function(a){d?this.c.fillText(a,b,c,d):this.c.fillText(a,b,c);c+=e},this);return this},measureText:function(a){return this.c.measureText(a).width},moveTo:function(a,b){this.c.moveTo(a||0,b||0);return this},lineTo:function(a,b){this.c.lineTo(a||0,b||0);return this},save:function(){this.c.save();return this},restore:function(){this.c.restore();return this},beginPath:function(){this.c.beginPath();return this},closePath:function(){this.c.closePath();return this},stroke:function(){this.c.stroke();return this},fill:function(){this.c.fill();return this},text:function(a,b,c,d,g,f,e,h,i,k){this.c.save();this.textStyle(f,e,h);this.fillText(a,b,c,d,g,i,k);this.c.restore();return this},cube:function(a,b,c,d,g,f,e,h,l,k,o,j,n,m,p,r){a=q(k,a);b=q(k,b);e=e&&0<e?e:g;d=b-e*d;c=q(k,a+e*c);d=q(k,d);j&&(this.polygon(h,l,k,o,j,n,m,p,r,!1,[a,b,c,d,c+g,d,a+g,b]),this.polygon(h,l,k,o,j,n,m,p,r,!1,[a,b,a,b+f,a+g,b+f,a+g,b]),this.polygon(h,l,k,o,j,n,m,p,r,!1,[a+g,b,c+g,d,c+g,d+f,a+g,b+f]));this.polygon(i.dark(h),l,k,o,!1,n,m,p,r,!1,[a,b,c,d,c+g,d,a+g,b]);this.polygon(h,l,k,o,!1,n,m,p,r,!1,[a,b,a,b+f,a+g,b+f,a+g,b]);this.polygon(i.dark(h),l,k,o,!1,n,m,p,r,!1,[a+g,b,c+g,d,c+g,d+f,a+g,b+f]);return this},cube3D:function(a,b,c,d,g,f,e,h,l,k,o,j){a=q(k,a);b=q(k,b);h=!h||0==h?f:h;g?(d=i.vectorP2P(c,d),c=a+h*d.x,d=b-h*d.y):(c=a+h*c,d=b-h*d);for(;6>j.length;)j.push(!1);c=q(k,c);d=q(k,d);h=[];0>d?i.isObject(j[4])&&h.push(i.applyIf({points:[a,b-e,c,d-e,c+f,d-e,a+f,b-e]},j[4])):i.isObject(j[0])&&h.push(i.applyIf({points:[a,b,c,d,c+f,d,a+f,b]},j[0]));i.isObject(j[1])&&h.push(i.applyIf({points:[c,d,c,d-e,c+f,d-e,c+f,d]},j[1]));i.isObject(j[2])&&h.push(i.applyIf({points:[a,b,a,b-e,c,d-e,c,d]},j[2]));i.isObject(j[3])&&h.push(i.applyIf({points:[a+f,b,a+f,b-e,c+f,d-e,c+f,d]},j[3]));0>d?i.isObject(j[0])&&h.push(i.applyIf({points:[a,b,c,d,c+f,d,a+f,b]},j[0])):i.isObject(j[4])&&h.push(i.applyIf({points:[a,b-e,c,d-e,c+f,d-e,a+f,b-e]},j[4]));i.isObject(j[5])&&h.push(i.applyIf({points:[a,b,a,b-e,a+f,b-e,a+f,b]},j[5]));h.each(function(a){this.polygon(a.color,l,k,o,a.shadow,a.shadowColor,a.blur,a.sx,a.sy,a.alpha,a.points)},this);return this},polygon:function(a,b,c,d,g,f,e,h,i,k,o){if(!(2>o.length)){this.c.save();this.strokeStyle(c,d);this.c.beginPath();this.fillStyle(a).globalAlpha(k).shadowOn(g,f,e,h,i).moveTo(o[0],o[1]);for(a=2;a<o.length;a+=2)this.lineTo(o[a],o[a+1]);this.c.closePath();b&&this.c.stroke();this.c.fill();this.c.restore();return this}},line:function(a,b,c,d,g,f,e){if(!g||0==g)return this;this.c.save();e&&(this.c.globalCompositeOperation="destination-over");a=q(g,a);b=q(g,b);c=q(g,c);d=q(g,d);this.c.beginPath();this.strokeStyle(g,f).moveTo(a,b).lineTo(c,d).c.stroke();this.c.closePath();this.c.restore();return this},round:function(a,b,c,d,g,f){this.c.beginPath();this.c.fillStyle=d;this.c.arc(a,b,c,0,x,!1);this.c.closePath();this.c.fill();g&&(this.c.lineWidth=g,this.c.strokeStyle=f||"#010101",this.c.stroke());return this},backgound:function(a,b,c,d,g){this.c.save();this.c.globalCompositeOperation="destination-over";this.c.translate(a,b);this.c.beginPath();this.c.fillStyle=g;this.c.fillRect(0,0,c,d);this.c.restore();return this},rectangle:function(a,b,c,d,g,f,e,h,l,k,o,j,n){this.c.save();a=q(e,a);b=q(e,b);this.c.translate(a,b);this.c.beginPath();this.c.fillStyle=g;this.shadowOn(l,k,o,j,n);f&&i.isNumber(e)&&(this.c.lineWidth=e,this.c.strokeStyle=h,this.c.strokeRect(0,0,c,d));this.c.fillRect(0,0,c,d);f&&i.isArray(e)&&(this.c.strokeStyle=h,this.line(0,0,c,0,e[0],h),this.line(c,0,c,d,e[1],h),this.line(0,d,c,d,e[2],h),this.line(0,0,0,d,e[3],h));this.c.restore();return this},clearRect:function(a,b,c,d){c=c||this.width;d=d||this.height;this.c.clearRect(a||0,b||0,c,d);return this},drawBorder:function(a,b,c,d,g,f,e,h,l,k,o,j,n,m){this.c.save();var p=q(g,a),r=q(g,b);p!=a&&(a=p,c-=1);r!=b&&(b=r,d-=1);this.c.translate(a,b);this.c.lineWidth=g;this.c.strokeStyle=f;l&&(this.c.globalCompositeOperation="destination-over");h&&(this.c.fillStyle=h);e=0==e?0:i.parseBorder(e);i.isArray(e)?(this.c.beginPath(),this.c.moveTo(e[0],0),this.c.lineTo(c-e[1],0),this.c.arcTo(c,0,c,e[1],e[1]),this.c.lineTo(c,d-e[2]),this.c.arcTo(c,d,c-e[2],d,e[2]),this.c.lineTo(e[3],d),this.c.arcTo(0,d,0,d-e[3],e[3]),this.c.lineTo(0,e[0]),this.c.arcTo(0,0,e[0],0,e[0]),this.c.closePath(),this.shadowOn(k,o,j,n,m),h&&this.c.fill(),k&&this.shadowOff(),this.c.globalCompositeOperation="source-over",this.c.stroke()):(this.shadowOn(k,o,j,n,m),h&&this.c.fillRect(0,0,c,d),k&&this.shadowOff(),this.c.strokeRect(0,0,c,d));this.c.restore();return this},toImageURL:function(){return this.canvas.toDataURL("image/png")},addEvent:function(a,b,c){i.Event.addEvent(this.canvas,a,b,c)}};iChart.Chart=iChart.extend(iChart.Painter,{configure:function(){i.Chart.superclass.configure.apply(this,arguments);this.type="chart";this.set({render:"",data:[],width:void 0,height:void 0,align:"center",default_mouseover_css:!0,segmentRect:!0,showpercent:!1,decimalsnum:1,title:"",title_align:"center",title_valign:"top",title_writingmode:"lr",title_font:"Verdana",title_fontweight:"bold",title_fontsize:20,title_color:"black",title_height:25,animation:!1,doAnimationFn:i.emptyFn,animation_timing_function:"easeInOut",duration_animation_duration:1600,legend:{enable:!1},tip:{enable:!1}});this.registerEvent("parseData","parseTipText","beforeAnimation","afterAnimation","animating");this.T=null;this.animationed=this.rendered=!1;this.data=[];this.components=[];this.total=0},pushComponent:function(a,b){b?this.components.unshift(a):this.components.push(a)},plugin:function(a,b){this.init();a.inject(this);this.pushComponent(a,b)},toImageURL:function(){return this.T.toImageURL()},segmentRect:function(){this.T.clearRect(this.get("l_originx"),this.get("t_originy"),this.get("client_width"),this.get("client_height"))},resetCanvas:function(){this.T.backgound(this.get("l_originx"),this.get("t_originy"),this.get("client_width"),this.get("client_height"),this.get("background_color"))},animation:function(){return function(a){a.segmentRect();a.doAnimation(a.variable.animation.time,a.duration);a.resetCanvas();a.variable.animation.time<a.duration?(a.variable.animation.time++,setTimeout(function(){a.animation(a)},i.INTERVAL)):setTimeout(function(){a.variable.animation.time=0;a.animationed=!0;a.draw();a.processAnimation=!1;a.fireEvent(this,"afterAnimation",[this])},i.INTERVAL)}}(),doAnimation:function(a,b){this.get("doAnimationFn").call(this,a,b)},add:function(a,b,c){if(this.processAnimation)return this.variable.animation.queue.push({handler:"add",arguments:[a,b,c]}),!1;iChart.isNumber(b);b=iChart.between(0,this.data.length,b);a=i.Interface.parser.call(this,a,b);this.get("legend.enable")&&this.legend.calculate(this.data,a);return a},commonDraw:function(){i.Assert.isTrue(this.rendered,this.type+" has not rendered.");i.Assert.isTrue(this.initialization,this.type+" has initialize failed.");i.Assert.gtZero(this.data.length,this.type+"'data is empty.");this.redraw||(this.title(),this.get("border.enable")?this.T.drawBorder(0,0,this.width,this.height,this.get("border.width"),this.get("border.color"),this.get("border.radius"),this.get("background_color"),!0):this.T.backgound(0,0,this.width,this.height,this.get("background_color")));this.redraw=!0;!this.animationed&&this.get("animation")?(this.fireEvent(this,"beforeAnimation",[this]),this.animation(this)):(this.segmentRect(),this.components.eachAll(function(a){a.draw()},this),this.resetCanvas())},title:function(){""!=this.get("title")&&("tb"!=this.get("title_writingmode")&&("left"==this.get("title_align")?this.push("title_originx",this.get("padding_left")):"right"==this.get("title_align")?this.push("title_originx",this.width-this.get("padding_right")):this.push("title_originx",this.get("client_width")/2),this.T.textAlign(this.get("title_align")),"bottom"==this.get("title_valign")?this.push("title_originy",this.height-this.get("padding_bottom")):this.push("title_originy",this.get("padding_top")),this.T.textBaseline(this.get("title_valign"))),this.T.textFont(i.getFont(this.get("title_fontweight"),this.get("title_fontsize"),this.get("title_font"))),this.T.fillText(this.get("title"),this.get("title_originx"),this.get("title_originy"),this.get("client_width"),this.get("title_color")))},create:function(a){this.width=this.pushIf("width",400);this.height=this.pushIf("height",300);var b="width:"+this.width+"px;height:"+this.height+"px;padding:0px;overflow:hidden;position:relative;",c=i.iGather(this.type);this.shellid=i.iGather(this.type+"-shell");a.innerHTML="<div id='"+this.shellid+"' style='"+b+"'><canvas id= '"+c+"'  width='"+this.width+"' height="+this.height+"'><p>Your browser does not support the canvas element</p></canvas></div>";this.element=document.getElementById(c);this.shell=document.getElementById(this.shellid);this.T=this.target=new w(this.element);this.rendered=!0},render:function(a){this.push("render",a)},initialize:function(){if(!this.rendered){var a=this.get("render");"string"==typeof a&&document.getElementById(a)?this.create(document.getElementById(a)):"object"==typeof a&&this.create(a)}0<this.get("data").length&&this.rendered&&!this.initialization&&(i.Interface.parser.call(this,this.get("data")),this.doConfig(),this.initialization=!0)},doConfig:function(){i.Chart.superclass.doConfig.call(this);var a=this,b=a.variable.event,c=a.get("default_mouseover_css"),d,g;i.Assert.isArray(a.data);i.Interface._3D.call(a);a.T.strokeStyle(a.get("brushsize"),a.get("strokeStyle"),a.get("lineJoin"));a.processAnimation=a.get("animation");a.duration=Math.ceil(a.get("duration_animation_duration")*i.FRAME/1E3);a.variable.animation={type:0,time:0,queue:[]};a.animationArithmetic=i.getAnimationArithmetic(a.get("animation_timing_function"));a.on("afterAnimation",function(){var b=a.variable.animation.queue.shift();b&&a[b.handler].apply(a,b.arguments)});["click","dblclick","mousemove"].each(function(b){a.T.addEvent(b,function(c){a.processAnimation||a.fireEvent(a,b,[a,i.Event.fix(c)])},!1)});a.on("click",function(a,b){a.components.eachAll(function(a){if(!a.preventEvent){var c=a.isMouseOver(b);c.valid&&a.fireEvent(a,"click",[a,b,c])}})});a.on("mousemove",function(a,e){d=g=!1;a.components.eachAll(function(f){if(!f.preventEvent){var i=f.variable.event,j=f.isMouseOver(e);j.valid?(d=!0,g=g||f.atomic,b.mouseover||(b.mouseover=!0,a.fireEvent(a,"mouseover",[e])),c&&g&&a.T.css("cursor","pointer"),i.mouseover||(i.mouseover=!0,f.fireEvent(f,"mouseover",[e,j])),f.fireEvent(f,"mousemove",[e,j])):i.mouseover&&(i.mouseover=!1,f.fireEvent(f,"mouseout",[e,j]))}});c&&!g&&b.mouseover&&a.T.css("cursor","default");!d&&b.mouseover&&(b.mouseover=!1,a.fireEvent(a,"mouseout",[e]))});a.push("l_originx",a.get("padding_left"));a.push("r_originx",a.width-a.get("padding_right"));a.push("t_originy",a.get("padding_top"));a.push("b_originy",a.height-a.get("padding_bottom"));var f=0,e=0;""!=a.get("title")&&("tb"==a.get("title_writingmode")?(f=a.get("title_height"),"left"==a.get("title_align")?a.push("l_originx",a.get("l_originx")+a.get("title_height")):a.push("r_originx",a.width-a.get("l_originx")-a.get("title_height"))):(e=a.get("title_height"),"left"==a.get("title_align")?a.push("title_originx",a.get("padding_left")):"right"==a.get("title_align")?a.push("title_originx",a.width-a.get("padding_right")):a.push("title_originx",a.get("client_width")/2),"bottom"==a.get("title_valign")?(a.push("title_originy",a.height-a.get("padding_bottom")),a.push("b_originy",a.height-a.get("b_originy")-a.get("title_height"))):(a.push("t_originy",a.get("t_originy")+a.get("title_height")),a.push("title_originy",a.get("padding_top")))));a.push("client_width",a.get("width")-a.get("hpadding")-f);a.push("client_height",a.get("height")-a.get("vpadding")-e);a.push("minDistance",Math.min(a.get("client_width"),a.get("client_height")));a.push("maxDistance",Math.max(a.get("client_width"),a.get("client_height")));a.push("minstr",a.get("client_width")<a.get("client_height")?"width":"height");a.push("centerx",a.get("l_originx")+a.get("client_width")/2);a.push("centery",a.get("t_originy")+a.get("client_height")/2);a.get("legend.enable")&&(a.legend=new i.Legend(i.apply({maxwidth:a.get("client_width"),data:a.data},a.get("legend")),a),a.components.push(a.legend));a.get("tip.enable")&&a.push("tip.wrap",a.shell)}})})(iChart);