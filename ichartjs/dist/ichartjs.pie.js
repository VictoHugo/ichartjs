(function(b){b.Sector=b.extend(b.Component,{configure:function(){b.Sector.superclass.configure.apply(this,arguments);this.type="sector";this.set({value:"",name:"",ignored:!1,counterclockwise:!1,startAngle:0,middleAngle:0,endAngle:0,totalAngle:0,bound_event:"click",expand:!1,donutwidth:0,mutex:!1,increment:void 0,gradient_mode:"RadialGradientOutIn",mini_label_threshold_angle:15,mini_label:!1,label:{}});this.atomic=!0;this.registerEvent("changed","parseText");this.tip=this.label=null},bound:function(){this.expanded||this.toggle()},rebound:function(){this.expanded&&this.toggle()},toggle:function(){this.fireEvent(this,this.get("bound_event"),[this])},getDimension:function(){var a=this._();return{x:a.x,x:a.y,startAngle:a.get("startAngle"),middleAngle:a.get("middleAngle"),endAngle:a.get("endAngle")}},doDraw:function(a){a.get("ignored")||(a.label&&!a.get("mini_label")&&a.label.draw(),a.drawSector(),a.label&&a.get("mini_label")&&a.label.draw())},doText:function(a,d,c){a.push("label.originx",d);a.push("label.originy",c);a.push("label.textBaseline","middle");a.label=new b.Text(a.get("label"),a)},doLabel:function(a,d,c,g,f,e,i,h){a.push("label.originx",d);a.push("label.originy",c);a.push("label.quadrantd",g);a.push("label.line_points",f);a.push("label.labelx",e);a.push("label.labely",i);a.push("label.smooth",h);a.push("label.angle",a.get("middleAngle")%(2*Math.PI));a.label=new b.Label(a.get("label"),a)},isLabel:function(){return this.get("label")&&!this.get("mini_label")},doConfig:function(){b.Sector.superclass.doConfig.call(this);var a=this._(),d=a.variable.event,c=a.get("label"),g=a.get("bound_event"),f;b.taylor.light(a,d);a.push("totalAngle",a.get("endAngle")-a.get("startAngle"));c&&(a.get("mini_label")&&(a.get("mini_label_threshold_angle")*Math.PI/180>a.get("totalAngle")?a.push("mini_label",!1):b.apply(a.get("label"),a.get("mini_label"))),a.push("label.text",a.fireString(a,"parseText",[a,a.get("label.text")],a.get("label.text"))),a.pushIf("label.border.color",a.get("border.color")),a.push("label.scolor",a.get("background_color")));a.variable.event.status=a.expanded=a.get("expand");a.get("tip.enable")&&("follow"!=a.get("tip.showType")&&a.push("tip.invokeOffsetDynamic",!1),a.tip=new b.Tip(a.get("tip"),a));d.poped=!1;a.on(g,function(){d.poped=true;a.expanded=!a.expanded;a.redraw(g);d.poped=false});a.on("beforedraw",function(b,i){if(i==g){f=false;a.x=a.get(a.X);a.y=a.get(a.Y);if(a.expanded)if(a.get("mutex")&&!d.poped){a.expanded=false;f=true}else{a.x=a.x+a.get("inc_x");a.y=a.y-a.get("inc_y")}if(d.status!=a.expanded){a.fireEvent(a,"changed",[a,a.expanded]);f=true;d.status=a.expanded}c&&f&&a.label.doLayout(a.get("inc_x")*(a.expanded?1:-1),-a.get("inc_y")*(a.expanded?1:-1),2,a.label)}return true})}});b.Sector2D=b.extend(b.Sector,{configure:function(){b.Sector2D.superclass.configure.apply(this,arguments);this.type="sector2d";this.set({radius:0})},drawSector:function(){this.T.sector(this.x,this.y,this.r,this.get("donutwidth"),this.get("startAngle"),this.get("endAngle"),this.get("f_color"),this.get("border.enable"),this.get("border.width"),this.get("border.color"),this.get("shadow"),this.get("counterclockwise"))},isEventValid:function(a,d){if(!d.get("ignored")){if(d.isLabel()&&d.label.isEventValid(a,d.label).valid)return{valid:!0};var c=b.distanceP2P(d.x,d.y,a.x,a.y),g=d.get("donutwidth");if(d.r<c||g&&d.r-g>c)return{valid:!1};if(b.angleInRange(d.get("startAngle"),d.get("endAngle"),b.atan2Radian(d.x,d.y,a.x,a.y)))return{valid:!0}}return{valid:!1}},tipInvoke:function(){return function(a,d){var c=b.p2Point(this.x,this.y,this.get("middleAngle"),0.8*this.r),g=b.quadrantd(this.get("middleAngle"));return{left:2<=g&&3>=g?c.x-a:c.x,top:3<=g?c.y-d:c.y}}},doConfig:function(){b.Sector2D.superclass.doConfig.call(this);var a=this._();a.r=a.get("radius");b.Assert.gt(a.r,0);a.get("donutwidth")>a.r&&a.push("donutwidth",0);a.applyGradient(a.x-a.r,a.y-a.r,2*a.r,2*a.r);var d=a.get("middleAngle"),c=a.pushIf("increment",b.lowTo(5,a.r/10));a.push("inc_x",c*Math.cos(2*Math.PI-d));a.push("inc_y",c*Math.sin(2*Math.PI-d));c*=2;if(a.get("label"))if(a.get("mini_label"))P2=b.p2Point(a.x,a.y,d,a.get("donutwidth")?a.r-a.get("donutwidth")/2:a.r/2),a.doText(a,P2.x,P2.y);else{var g=b.quadrantd(d),f=b.p2Point(a.x,a.y,d,a.r+c),e=b.p2Point(a.x,a.y,d,a.r+0.6*c);P2=b.p2Point(a.x,a.y,d,a.r);a.doLabel(a,P2.x,P2.y,g,[{x:P2.x,y:P2.y},{x:e.x,y:e.y},{x:f.x,y:f.y}],f.x,f.y,0.4*c)}}});b.Sector3D=b.extend(b.Sector,{configure:function(){b.Sector3D.superclass.configure.apply(this,arguments);this.type="sector3d";this.dimension=b._3D;this.set({semi_major_axis:0,semi_minor_axis:0,cylinder_height:0})},drawSector:function(){this.T.sector3D(this.x,this.y,this.a,this.b,this.get("startAngle"),this.get("endAngle"),this.h,this.get("f_color"),this.get("border.enable"),this.get("border.width"),this.get("border.color"),this.get("shadow"),this.get("shadow_color"),this.get("shadow_blur"),this.get("shadow_offsetx"),this.get("shadow_offsety"),this.get("counterclockwise"))},isEventValid:function(a,d){if(!d.get("ignored")){if(d.isLabel()&&d.label.isEventValid(a,d.label).valid)return{valid:!0};if(!b.inEllipse(a.x-d.x,a.y-d.y,d.a,d.b))return{valid:!1};if(b.angleZInRange(d.sA,d.eA,b.atan2Radian(d.x,d.y,a.x,a.y)))return{valid:!0}}return{valid:!1}},p2p:function(a,d,c,b){return{x:a+this.a*Math.cos(c)*b,y:d+this.b*Math.sin(c)*b}},tipInvoke:function(){var a=this,d=a.get("middleAngle"),c=b.quadrantd(d);return function(b,f){var e=a.p2p(a.x,a.y,d,0.6);return{left:2<=c&&3>=c?e.x-b:e.x,top:3<=c?e.y-f:e.y}}},doConfig:function(){b.Sector3D.superclass.doConfig.call(this);var a=this._(),d=a.get("counterclockwise"),c=a.get("middleAngle");a.a=a.get("semi_major_axis");a.b=a.get("semi_minor_axis");a.h=a.get("cylinder_height");b.Assert.gt(a.a,0);b.Assert.gt(a.b,0);var g=2*Math.PI,f=function(c){for(;0>c;)c+=g;return Math.abs(b.atan2Radian(0,0,a.a*Math.cos(c),d?-a.b*Math.sin(c):a.b*Math.sin(c)))},e=a.pushIf("increment",b.lowTo(5,a.a/10));a.sA=f.call(a,a.get("startAngle"));a.eA=f.call(a,a.get("endAngle"));a.mA=f.call(a,c);a.push("inc_x",e*Math.cos(g-a.mA));a.push("inc_y",e*Math.sin(g-a.mA));e*=2;if(a.get("label"))if(a.get("mini_label"))e=a.p2p(a.x,a.y,c,0.5),a.doText(a,e.x,e.y);else{var f=b.quadrantd(c),i=a.p2p(a.x,a.y,c,e/a.a+1),h=a.p2p(a.x,a.y,c,0.6*e/a.a+1),c=a.p2p(a.x,a.y,c,1);a.doLabel(a,c.x,c.y,f,[{x:c.x,y:c.y},{x:h.x,y:h.y},{x:i.x,y:i.y}],i.x,i.y,0.4*e)}}});b.Label=b.extend(b.Component,{configure:function(){b.Label.superclass.configure.apply(this,arguments);this.type="label";this.set({text:"",line_height:12,line_thickness:1,sign:"square",sign_size:12,padding:"2 5",offsety:2,sign_space:5,background_color:"#efefef",text_with_sign_color:!1});this.atomic=!0;this.registerEvent()},isEventValid:function(a,d){return{valid:b.inRange(d.labelx,d.labelx+d.get(d.W),a.x)&&b.inRange(d.labely,d.labely+d.get(d.H),a.y)}},text:function(a){a&&this.push("text",a);this.push(this.W,this.T.measureText(this.get("text"))+this.get("hpadding")+this.get("sign_size")+this.get("sign_space"))},localizer:function(a){var d=a.get("quadrantd"),c=a.get("line_points"),b=a.get("smooth"),d=1<=d&&2>=d,f=a.get("labelx"),e=a.get("labely");a.labelx=f+(d?-a.get(a.W)-b:b);a.labely=e-a.get(a.H)/2;c[2]={x:f,y:e};c[3]={x:c[2].x+(d?-b:b),y:c[2].y}},doLayout:function(a,d,c,b){b.push("labelx",b.get("labelx")+a/c);b.push("labely",b.get("labely")+d/c);b.get("line_points").each(function(b,c){b.x+=a;b.y+=d;return 1==c},b);b.localizer(b)},doDraw:function(a){var b=a.get("line_points"),c=a.get("sign_size"),g=a.labelx+a.get("padding_left"),f=a.labely+a.get("padding_top");a.T.label(b,a.get("line_thickness"),a.get("border.color"));a.T.box(a.labelx,a.labely,a.get(a.W),a.get(a.H),a.get("border"),a.get("f_color"),!1,a.get("shadow"));a.T.textStyle(a.L,a.O,a.get("fontStyle"));b=a.get("color");a.get("text_with_sign_color")&&(b=a.get("scolor"));"square"==a.get("sign")?a.T.box(g,f,c,c,0,a.get("scolor")):a.get("sign")&&a.T.round(g+c/2,f+c/2,c/2,a.get("scolor"));a.T.fillText(a.get("text"),g+c+a.get("sign_space"),f,a.get("textwidth"),b)},doConfig:function(){b.Label.superclass.doConfig.call(this);var a=this._();a.T.textFont(a.get("fontStyle"));a.get("fontsize")>a.get("line_height")&&a.push("line_height",a.get("fontsize"));a.get("sign")||(a.push("sign_size",0),a.push("sign_space",0));a.push(a.H,a.get("line_height")+a.get("vpadding"));a.text();a.localizer(a)}});b.Pie=b.extend(b.Chart,{configure:function(){b.Pie.superclass.configure.call(this);this.type="pie";this.set({radius:0,offset_angle:0,separate_angle:0,bound_event:"click",counterclockwise:!1,intellectLayout:!0,layout_distance:4,pop_animate:!1,mutex:!1,increment:void 0,sub_option:{label:{}}});this.registerEvent("bound","rebound")},toggle:function(a){this.sectors[a||0].toggle()},bound:function(a){this.sectors[a||0].bound()},rebound:function(a){this.sectors[a||0].rebound()},getSectors:function(){return this.sectors},doAnimation:function(a,b,c){var g=0,f=c.oA;c.sectors.each(function(e){g=c.animationArithmetic(a,0,e.get("totalAngle"),b);e.push("startAngle",f);e.push("endAngle",f+g);f+=g;c.is3D()||e.drawSector()});c.is3D()&&c.proxy.drawSector()},parse:function(a){a.data.each(function(b,c){a.doParse(a,b,c)},a);a.localizer(a)},doParse:function(a,b,c){var g=b.name+" "+a.getPercent(b.value);a.doActing(a,b,c,g);a.push("sub_option.id",c);a.get("sub_option.label")&&a.push("sub_option.label.text",g);a.push("sub_option.listeners.changed",function(b,c){a.fireEvent(a,c?"bound":"rebound",[a,b.get("name")])});a.sectors.push(a.doSector(a,b))},dolayout:function(a,d,c,g,f,e){if(a.is3D()?b.inEllipse(a.get(a.X)-d,a.get(a.Y)-c,a.a,a.b):b.distanceP2P(a.get(a.X),a.get(a.Y),d,c)<a.r)c=a.get(a.Y)-c,g.push("labelx",a.get(a.X)+(2*Math.sqrt(a.r*a.r-c*c)+f)*(0==e||3==e?1:-1)),g.localizer(g)},localizer:function(a){if(a.get("intellectLayout")){var b=[],c=[],g=a.get("layout_distance"),f;a.sectors.each(function(a){a.isLabel()&&b.push(a.label)});var e=Math.PI,i=function(a,b){for(;0>a;)a+=2*e;if(0==b)return a;if(1==b)return e-a;if(2==b)return a-e;if(3==b)return 2*e-a};b.sor(function(a,b){return 0<i(a.get("angle"),a.get("quadrantd"))-i(b.get("angle"),b.get("quadrantd"))});b.each(function(b){c.each(function(c){var d=c.labelx,e=c.labely;if(b.labely<=e&&e-b.labely-1<b.get(a.H)||b.labely>e&&b.labely-e-1<c.get(a.H))if(b.labelx<d&&d-b.labelx<b.get(a.W)||b.labelx>d&&b.labelx-d<c.get(a.W))f=b.get("quadrantd"),b.push("labely",b.get("labely")+e-b.labely+(b.get(a.H)+g)*(1<f?-1:1)),b.localizer(b),a.dolayout(a,b.get("labelx"),b.get("labely")+b.get(a.H)/2*(2>f?-1:1),b,g,f)},a);c.push(b)})}},doConfig:function(){b.Pie.superclass.doConfig.call(this);b.Assert.gt(this.total,0,"this.total");var a=this._(),d=a.get("radius"),c=a.get("sub_option.label")?0.35:0.44,g=2*Math.PI;a.sub=a.is3D()?"Sector3D":"Sector2D";a.sectors=[];a.sectors.zIndex=a.get("z_index");a.components.push(a.sectors);a.oA=b.angle2Radian(a.get("offset_angle"))%g;a.is3D()&&(c+=0.06);var c=a.get("minDistance")*c,f=a.data.length,e=b.angle2Radian(b.between(0,90,a.get("separate_angle"))),i=g-e,e=e/f,h=a.oA+e,j=h;a.data.each(function(b,c){h+=b.value/a.total*i;c==f-1&&(h=g+a.oA);b.startAngle=j;b.endAngle=h;b.totalAngle=h-j;b.middleAngle=(j+h)/2;j=h+e},a);if(0>=d||d>c)d=a.push("radius",Math.floor(c));a.r=d;a.get("align")==a.L?a.push(a.X,d+a.get("l_originx")+a.get("offsetx")):a.get("align")==a.R?a.push(a.X,a.get("r_originx")-d+a.get("offsetx")):a.push(a.X,a.get("centerx")+a.get("offsetx"));a.push(a.Y,a.get("centery")+a.get("offsety"));b.apply(a.get("sub_option"),b.clone([a.X,a.Y,"bound_event","mutex","increment"],a.options))}});b.Pie2D=b.extend(b.Pie,{configure:function(){b.Pie2D.superclass.configure.call(this);this.type="pie2d"},doSector:function(a){return new b[a.sub](a.get("sub_option"),a)},doConfig:function(){b.Pie2D.superclass.doConfig.call(this);var a=this._();a.push("sub_option.radius",a.r);a.parse(a)}});b.Donut2D=b.extend(b.Pie,{configure:function(){b.Donut2D.superclass.configure.call(this);this.type="donut2d";this.set({donutwidth:0.3,center:{text:"",line_height:24,fontweight:"bold",fontsize:24}})},doSector:function(){return new b.Sector2D(this.get("sub_option"),this)},doConfig:function(){b.Donut2D.superclass.doConfig.call(this);var a=this._(),d=a.r;a.push("sub_option.radius",d);0<a.get("donutwidth")&&(1>a.get("donutwidth")?a.push("donutwidth",Math.floor(d*a.get("donutwidth"))):a.get("donutwidth")>=d&&a.push("donutwidth",0),a.push("sub_option.donutwidth",a.get("donutwidth")));b.isString(a.get("center"))&&a.push("center",b.applyIf({text:a.get("center")},a.default_.center));""!=a.get("center.text")&&(a.push("center.originx",a.get(a.X)),a.push("center.originy",a.get(a.Y)),a.push("center.textBaseline","middle"),a.components.push(new b.Text(a.get("center"),a)));a.parse(a)}});b.Pie3D=b.extend(b.Pie,{configure:function(){b.Pie3D.superclass.configure.apply(this,arguments);this.type="pie3d";this.dimension=b._3D;this.set({zRotate:45,yHeight:30})},doSector:function(a,d){a.push("sub_option.cylinder_height",d.cylinder_height?d.cylinder_height*Math.cos(b.angle2Radian(a.get("zRotate"))):a.get("cylinder_height"));var c=new b[a.sub](a.get("sub_option"),a);c.proxy=!0;return c},doConfig:function(){b.Pie3D.superclass.doConfig.call(this);var a=this._(),d=a.get("zRotate");a.push("zRotate",b.between(0,90,90-d));a.push("cylinder_height",a.get("yHeight")*Math.cos(b.angle2Radian(d)));a.a=a.push("sub_option.semi_major_axis",a.r);a.b=a.push("sub_option.semi_minor_axis",a.r*d/90);a.push("sub_option.originy",a.get(a.Y)-a.get("yHeight")/2);a.parse(a);var c=[],g=[],f=Math.PI,e=2*f,i=f/2,h=1.5*f,j=a.get("counterclockwise"),k=function(a,b){a=Math.abs(a-b);return a>f?e-a:a};a.proxy=new b.Custom({z_index:a.get("z_index")+1,drawFn:function(){this.drawSector();g=[];a.sectors.each(function(a){a.get("label")&&(a.expanded?g.push(a.label):a.label.draw())});g.each(function(a){a.draw()})}});a.proxy.drawSector=function(){a.sectors.each(function(b){a.T.ellipse(b.x,b.y+b.h,b.a,b.b,b.get("startAngle"),b.get("endAngle"),b.get("f_color"),b.get("border.enable"),b.get("border.width"),b.get("border.color"),b.get("shadow"),j,!0)},a);c=[];var d,e;a.sectors.each(function(a){a.sPaint=!1;d=a.get("startAngle");e=a.get("endAngle");fc=b.dark(a.get("background_color"));(j?d<i||d>h:d>i&&d<h)&&c.push({g:d,z:d==e,x:a.x,y:a.y,a:a.a,b:a.b,color:fc,h:a.h,F:a});(j?e>i&&e<h:e<i||e>h)&&c.push({g:e,z:d==e,x:a.x,y:a.y,a:a.a,b:a.b,color:fc,h:a.h,F:a})},a);c.sor(function(a,b){var c=k(a.g,h)-k(b.g,h);return 0==c?a.z:0<c});c.each(function(b){a.T.sector3D.layerDraw.call(a.T,b.x,b.y,b.a+0.5,b.b+0.5,j,b.h,b.g,b.color);b.F.sPaint||(a.T.sector3D.sPaint.call(a.T,b.F.x,b.F.y,b.F.a,b.F.b,b.F.get("startAngle"),b.F.get("endAngle"),!1,b.F.h,b.color),b.F.sPaint=!0)},a);a.sectors.each(function(b){b.sPaint||a.T.sector3D.sPaint.call(a.T,b.x,b.y,b.a,b.b,b.get("startAngle"),b.get("endAngle"),!1,b.h,b.get("f_color"))},a);a.sectors.each(function(b){a.T.ellipse(b.x,b.y,b.a,b.b,b.get("startAngle"),b.get("endAngle"),b.get("f_color"),b.get("border.enable"),b.get("border.width"),b.get("border.color"),!1,!1,!0)},a)};a.components.push(a.proxy)}})})(iChart);