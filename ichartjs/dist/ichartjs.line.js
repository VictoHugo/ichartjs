(function(b){b.LineSegment=b.extend(b.Component,{configure:function(){b.LineSegment.superclass.configure.apply(this,arguments);this.type="linesegment";this.set({brushsize:1,intersection:!0,label:{},sign:"round",area_color:null,hollow:!0,hollow_inside:!0,hollow_color:"#FEFEFE",smooth:!1,smoothing:1.5,point_size:6,points:[],keep_with_coordinate:!1,shadow_blur:1,shadow_offsety:1,point_space:0,coordinate:null,event_range_x:0,limit_y:!1,tip_offset:2,event_range_y:0});this.registerEvent("parseText");this.tip=null},drawSegment:function(){var a=this._();a.polygons.each(function(b){a.T.polygon.apply(a.T,b)});a.T.shadowOn(a.get("shadow"));a.lines.each(function(b){a.T.lineArray.apply(a.T,b)});a.intersections.each(function(b){a.sign_plugin?a.sign_plugin_fn.apply(a,b):a.T.round0.apply(a.T,b)});a.get("shadow")&&a.T.shadowOff()},doDraw:function(a){a.drawSegment();a.get("label")&&a.labels.each(function(a){a.draw()})},isEventValid:function(){},tipInvoke:function(){var a=this.x,b=this.get("tip_offset"),i=this.get("point_size")+b,f=this;return function(c,k,g){var l=g.left,g=g.top,l=3>f.tipPosition&&0<l-c-a-b||2<f.tipPosition&&0>l-c-a-b?l-(c+b):l+b,g=0==f.tipPosition%2?g+i:g-k-i;return{left:l,top:g}}},PP:function(a,b,i,f,c,k){a.get("area")&&a.polygons.push([a.get("area_color")||a.get("light_color2"),0,a.get("brushsize"),0,0,a.get("area_opacity"),a.get("smooth")?b:[{x:i,y:f}].concat(b.concat([{x:c,y:k}])),a.get("smooth"),a.get("smoothing")||1.5,[{x:i,y:f},{x:c,y:k}]])},parse:function(a){a.polygons=[];a.lines=[];a.intersections=[];a.labels=[];var m=a.get("points"),i=a.get("intersection"),f=!!a.get("label"),c=[],k=!1,g=a.get("smooth"),l=a.get("smoothing")||1.5,j=a.get("f_color"),n=a.get("brushsize"),d=a.get("point_size");if(i){var h=a.getPlugin("sign"),o=j,p=a.get("hollow_color");a.sign_plugin=b.isFunction(h);a.sign_plugin_fn=h;a.get("hollow_inside")&&(o=p,p=j)}m.each(function(e){e.x_=e.x;e.y_=e.y;!e.ignored&&f&&(a.push("label.originx",e.x),a.push("label.originy",e.y-d/2-1),a.push("label.text",a.fireString(a,"parseText",[a,e.value],e.value)),b.applyIf(a.get("label"),{textBaseline:"bottom",color:a.get("f_color")}),a.labels.push(new b.Text(a.get("label"),a)));e.ignored&&k?(a.lines.push([c,n,j,g,l]),a.PP(a,c,c[0].x,a.y,c[c.length-1].x,a.y),c=[],k=!1):e.ignored||(c.push(e),k=!0);i&&!e.ignored&&a.intersections.push(a.sign_plugin?[a.T,a.get("sign"),e,d,e.color||o,e.hollow_color||p]:a.get("hollow")?[e,d/2-n+1,e.color||o,n+1,e.hollow_color||p]:[e,d/2,e.color||o])});c.length&&(a.lines.push([c,n,j,g,l]),a.PP(a,c,c[0].x,a.y,c[c.length-1].x,a.y))},doConfig:function(){b.LineSegment.superclass.doConfig.call(this);b.Assert.isTrue(0<this.get("point_space"),"point_space");var a=this._(),m=3*a.get("point_size")/2,i=a.get("point_space"),f=a.get("event_range_y"),c=a.get("event_range_x"),k=a.get("tipInvokeHeap"),g=a.get("points"),l=a.get("name");a.parse(a);if(0>=c||c>i/2)c=a.push("event_range_x",i/2);0==f&&(f=a.push("event_range_y",m/2));a.get("tip.enable")&&(a.on("mouseover",function(){k.push(a);a.tipPosition=k.length}).on("mouseout",function(){k.pop()}),a.push("tip.invokeOffsetDynamic",!0),a.tip=new b.Tip(a.get("tip"),a));var j=a.get("coordinate"),n=a.get("limit_y"),d=a.get("keep_with_coordinate"),h=function(a,b,d){return!a.ignored&&Math.abs(b-a.x)<c&&(!n||n&&Math.abs(d-a.y)<f)?true:false},o=function(a){return{valid:true,name:l,value:g[a].value,text:g[a].text,top:g[a].y,left:g[a].x,i:a,hit:true}};a.isEventValid=function(c){if(j&&!j.isEventValid(c,j).valid)return{valid:false};var e=Math.floor((c.x-a.x)/i);if(e<0||e>=g.length-1){e=b.between(0,g.length-1,e);return h(g[e],c.x,c.y)?o(e):{valid:d}}for(var f=e;f<=e+1;f++)if(h(g[f],c.x,c.y))return o(f);return{valid:d}}}});b.Line=b.extend(b.Chart,{configure:function(){b.Line.superclass.configure.call(this);this.type="line";this.set({brushsize:1,coordinate:{axis:{width:[0,0,2,2]}},crosshair:{enable:!1},tipMocker:null,tipMockerOffset:null,scaleAlign:"left",labelAlign:"bottom",labels:[],label_space:6,proportional_spacing:!0,sub_option:{},legend:{sign:"bar"},label:{}});this.registerEvent("parsePoint");this.lines=[];this.components.push(this.lines)},getCoordinate:function(){return this.coo},doConfig:function(){b.Line.superclass.doConfig.call(this);var a=this._(),m=1==a.data.length;a.lines.length=0;a.lines.zIndex=a.get("z_index");var i=a.pushIf("sub_option.keep_with_coordinate",m);a.get("crosshair.enable")&&(a.pushIf("crosshair.hcross",m),a.push("crosshair.invokeOffset",function(b){b=a.lines[0].isEventValid(b);return b.valid?b:i}));a.Combination||(a.push("coordinate.crosshair",a.get("crosshair")),a.pushIf("coordinate.scale",[{position:a.get("scaleAlign"),max_scale:a.get("maxValue")},{position:a.get("labelAlign"),start_scale:1,scale:1,end_scale:a.get("maxItemSize"),labels:a.get("labels"),label:a.get("label")}]));a.coo=b.Coordinate.coordinate_.call(a);a.Combination&&(a.coo.push("crosshair",a.get("crosshair")),a.coo.doCrosshair(a.coo));var m=a.coo.valid_width,f=m/(a.get("maxItemSize")-1);a.get("proportional_spacing")&&a.push("point_space",f);a.push("sub_option.width",m);a.push("sub_option.height",a.coo.valid_height);a.push("sub_option.originx",a.coo.get("x_start"));a.push("sub_option.originy",a.coo.get("y_end"));if(a.get("tip.enable")&&!a.mocker&&b.isFunction(a.get("tipMocker"))){a.push("sub_option.tip.enable",!1);a.push("tip.invokeOffsetDynamic",!0);var c,k=a.coo.get(a.X),g=a.coo.get(a.Y),l=a.coo.height,j=a.get("tipMockerOffset"),n,d,h,j=b.isNumber(j)?0>j?0:1<j?1:j:null;a.push("tip.invokeOffset",function(a,b,c){if(j!=null)c.top=g+(l-b)*j;else{c.top=c.maxTop-(c.maxTop-c.minTop)/3-b;if(b>l||g>c.top)c.top=g}return{left:c.left-a-k>5?c.left-a-5:c.left+5,top:c.top}});var o=a.get("tip.listeners.parseText");o&&delete a.get("tip.listeners").parseText;a.mocker=new b.Custom({eventValid:function(b){d=a.lines[0].isEventValid(b);d.hit=n!=d.i;if(d.valid){n=d.i;c=[];a.lines.each(function(a,f){h=a.isEventValid(b);if(f==0)d.minTop=d.maxTop=h.top;else{d.minTop=Math.min(d.minTop,h.top);d.maxTop=Math.max(d.maxTop,h.top)}c.push(o?o(null,h.name,h.value,h.text,h.i):h.name+" "+h.value)});d.text=a.get("tipMocker").call(a,c,d.i)||"tipMocker not return"}return d.valid?d:false}});new b.Tip(a.get("tip"),a.mocker);a.register(a.mocker)}a.pushIf("sub_option.area_opacity",a.get("area_opacity"))}});b.LineBasic2D=b.extend(b.Line,{configure:function(){b.LineBasic2D.superclass.configure.call(this);this.type="basicline2d";this.tipInvokeHeap=[]},doAnimation:function(a,b,i){i.lines.each(function(f){f.get("points").each(function(c){c.y=f.y-Math.ceil(i.animationArithmetic(a,0,f.y-c.y_,b))});f.drawSegment()})},doConfig:function(){b.LineBasic2D.superclass.doConfig.call(this);var a=this._(),m,i=a.coo.valid_height,f=a.get("point_space"),c,k,g,l=a.get("sub_option.originx"),j,n;a.push("sub_option.tip.showType","follow");a.push("sub_option.coordinate",a.coo);a.push("sub_option.tipInvokeHeap",a.tipInvokeHeap);a.push("sub_option.point_space",f);a.data.each(function(d){m=a.coo.getScale(d.scaleAlign||a.get("scaleAlign"));j=a.get("sub_option.originy")-m.basic*i;c=[];d.value.each(function(h,o){k=f*o;g=(h-m.start)*i/m.distance;n={x:l+k,y:j-g,value:h,text:d.name+" "+h};b.merge(n,a.fireEvent(a,"parsePoint",[d,h,k,g,o,m]));c.push(n)},a);b.merge(a.get("sub_option"),d);a.push("sub_option.points",c);a.push("sub_option.brushsize",d.linewidth||d.line_width);a.lines.push(new b.LineSegment(a.get("sub_option"),a))},this)}});b.register("LineBasic2D");b.Area2D=b.extend(b.LineBasic2D,{configure:function(){b.Area2D.superclass.configure.call(this);this.type="area2d";this.set({area_opacity:0.3})},doConfig:function(){this.push("sub_option.area",!0);b.Area2D.superclass.doConfig.call(this)}});b.register("Area2D")})(iChart);