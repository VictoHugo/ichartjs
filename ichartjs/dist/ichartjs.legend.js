(function(i){i.Legend=i.extend(i.Component,{configure:function(){i.Legend.superclass.configure.apply(this,arguments);this.type="legend";this.set({data:void 0,width:"auto",column:1,row:"max",maxwidth:0,line_height:16,sign:"square",sign_size:12,sign_space:5,legend_space:5,z_index:1009,text_with_sign_color:!1,align:"right",valign:"middle"});this.atomic=!0;this.registerEvent("parse","drawRaw","drawCell")},isEventValid:function(a,b){var f={valid:!1};a.x>this.x&&a.x<b.x+b.width&&a.y>b.y&&a.y<b.y+b.height&&b.data.each(function(c,e){a.x>c.x&&a.x<c.x+c.width_+b.get("signwidth")&&a.y>c.y&&a.y<c.y+b.get("line_height")&&(f={valid:!0,index:e,target:c})},b);return f},drawCell:function(a,b,f,c,e){var d=this.get("sign_size"),g=this.getPlugin("sign");if(!g||!g.call(this,this.T,e,a+d/2,b+d/2,d,c))-1!=e.indexOf("bar")&&this.T.box(a,b+5*d/12,d,d/6,0,c),"round"==e?this.T.round(a+d/2,b+d/2,d/2,c):"round-bar"==e?this.T.round(a+d/2,b+d/2,d/4,c):"square-bar"==e?this.T.box(a+d/4,b+d/4,d/2,d/2,0,c):"bar"!=e&&this.T.box(a,b,d,d,0,c);e=this.get("color");this.get("text_with_sign_color")&&(e=c);this.T.fillText(f,a+this.get("signwidth"),b+d/2,this.get("textwidth"),e)},drawRow:function(a,b,f){for(var c,e=0;e<this.get("column");e++)c=this.data[a],a<this.data.length&&(this.fireEvent(this,"drawCell",[this,c]),this.drawCell(b,f,c.text,c.color,c.sign||this.get("sign")),c.x=b,c.y=f),b+=this.columnwidth[e]+this.get("signwidth")+this.get("legend_space"),a++},doDraw:function(a){a.T.box(a.x,a.y,a.width,a.height,a.get("border"),a.get("f_color"),!1,a.get("shadow"));a.T.textStyle(a.L,"middle",i.getFont(a.get("fontweight"),a.get("fontsize"),a.get("font")));for(var b=a.x+a.get("padding_left"),f=a.y+a.get("padding_top"),c=a.get("column"),e=a.get("row"),d=0;d<e;d++)a.drawRow(d*c,b,f),f+=a.get("line_height"),a.fireEvent(a,"drawRaw",[a,d*c])},doConfig:function(){i.Legend.superclass.doConfig.call(this);var a=this._(),b=a.get("sign_size"),f=a.container;a.T.textFont(a.get("fontStyle"));a.push("signwidth",b+a.get("sign_space"));a.get("line_height")<b&&a.push("line_height",b+b/5);a.get("align")==a.C&&"middle"==a.get("valign")&&a.push("valign",a.O);f.get("align")==a.L&&"middle"==a.get("valign")&&a.push("align",a.R);var b=0,c=w=a.get(a.W),e=0,d="auto"==w,g=i.isNumber(a.get("column")),h=i.isNumber(a.get("row")),j=a.data.length;!g&&!h&&(g=1);g&&!h&&a.push("row",Math.ceil(j/a.get("column")));!g&&h&&a.push("column",Math.ceil(j/a.get("row")));g=a.get("column");h=a.get("row");j>h*g&&(h+=Math.ceil((j-h*g)/g),a.push("row",h));a.columnwidth=Array(g);d&&(c=0);a.data.each(function(b,c){i.merge(b,a.fireEvent(a,"parse",[a,b.name,c]));b.text=b.text||b.name;b.width_=a.T.measureText(b.text)},a);for(var k=0;k<g;k++){e=0;for(b=k;b<j;)e=Math.max(e,a.data[b].width_),b+=g;a.columnwidth[k]=e;c+=e}d&&(w=a.push(a.W,c+a.get("hpadding")+a.get("signwidth")*g+(g-1)*a.get("legend_space")));w>a.get("maxwidth")&&(w=a.push(a.W,a.get("maxwidth")));a.push("textwidth",w-a.get("hpadding")-a.get("signwidth"));a.width=w;a.height=b=a.push(a.H,h*a.get("line_height")+a.get("vpadding"));a.y=a.get("valign")==a.O?f.get("t_originy"):a.get("valign")==a.B?f.get("b_originy")-b:f.get("centery")-b/2;a.x=a.get("align")==a.L?f.get("l_originx"):a.get("align")==a.C?f.get("centerx")-a.get("textwidth")/2:f.get("r_originx")-w;a.x=a.push(a.X,a.x+a.get("offsetx"));a.y=a.push(a.Y,a.y+a.get("offsety"))}})})(iChart);