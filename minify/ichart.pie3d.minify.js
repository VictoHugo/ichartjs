iChart.Pie3D=iChart.extend(iChart.Pie,{configure:function(){iChart.Pie3D.superclass.configure.apply(this,arguments);this.type="pie3d";this.dimension=iChart._3D;this.set({zRotate:45,yHeight:30})},doSector:function(b){this.push("sub_option.cylinder_height",b.cylinder_height?b.cylinder_height*Math.cos(iChart.angle2Radian(this.get("zRotate"))):this.get("cylinder_height"));b=new iChart.Sector3D(this.get("sub_option"),this);b.proxy=!0;return b},doConfig:function(){iChart.Pie3D.superclass.doConfig.call(this);var b=this._(),j=b.get("zRotate");b.push("zRotate",iChart.between(0,90,90-j));b.push("cylinder_height",b.get("yHeight")*Math.cos(iChart.angle2Radian(j)));b.push("sub_option.semi_major_axis",b.r);b.push("sub_option.semi_minor_axis",b.r*j/90);b.push("sub_option.semi_major_axis",b.r);b.push("sub_option.originy",b.get("originy")-b.get("yHeight")/2);b.data.each(function(d,c){b.doParse(b,d,c)},b);var f=[],k=[],g=Math.PI,m=2*g,h=g/2,e=1.5*g,i=b.get("counterclockwise"),l=function(b,c){b=Math.abs(b-c);return b>g?m-b:b};b.proxy=new iChart.Custom({z_index:b.get("z_index")+1,drawFn:function(){this.drawSector();k=[];b.sectors.each(function(b){b.get("label")&&(b.expanded?k.push(b.label):b.label.draw())});k.each(function(b){b.draw()})}});b.proxy.drawSector=function(){b.sectors.each(function(a){b.T.ellipse(a.x,a.y+a.h,a.a,a.b,a.get("startAngle"),a.get("endAngle"),a.get("f_color"),a.get("border.enable"),a.get("border.width"),a.get("border.color"),a.get("shadow"),i,!0)},b);f=[];var d,c;b.sectors.each(function(a){a.sPaint=!1;d=a.get("startAngle");c=a.get("endAngle");fc=$.dark(a.get("background_color"));(i?d<h||d>e:d>h&&d<e)&&f.push({g:d,x:a.x,y:a.y,a:a.a,b:a.b,color:fc,h:a.h,F:a});(i?c>h&&c<e:c<h||c>e)&&f.push({g:c,x:a.x,y:a.y,a:a.a,b:a.b,color:fc,h:a.h,F:a})},b);f.sor(function(a,b){return 0<l(a.g,e)-l(b.g,e)});f.each(function(a){b.T.sector3D.layerDraw.call(b.T,a.x,a.y,a.a+0.5,a.b+0.5,i,a.h,a.g,a.color);a.F.sPaint||(b.T.sector3D.sPaint.call(b.T,a.F.x,a.F.y,a.F.a,a.F.b,a.F.get("startAngle"),a.F.get("endAngle"),!1,a.F.h,a.color),a.F.sPaint=!0)},b);b.sectors.each(function(a){a.sPaint||b.T.sector3D.sPaint.call(b.T,a.x,a.y,a.a,a.b,a.get("startAngle"),a.get("endAngle"),!1,a.h,a.get("f_color"))},b);b.sectors.each(function(a){b.T.ellipse(a.x,a.y,a.a,a.b,a.get("startAngle"),a.get("endAngle"),a.get("f_color"),a.get("border.enable"),a.get("border.width"),a.get("border.color"),!1,!1,!0)},b)};b.components.push(b.proxy)}});